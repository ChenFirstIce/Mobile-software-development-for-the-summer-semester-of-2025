# 2025年夏季《移动软件开发》实验报告



<center>姓名：陈怡冰  学号：23020007007</center>

| 姓名和学号？         | 陈怡冰，23020007007                                          |
| -------------------- | ------------------------------------------------------------ |
| 本实验属于哪门课程？ | 中国海洋大学25夏《移动软件开发》                             |
| 实验名称？           | 实验3：微信小程序云开发                                      |
| 博客地址？           | [OUC-2025年夏季《移动软件开发》实验报告-实验三-CSDN博客](https://blog.csdn.net/2301_81554020/article/details/151073877?sharetype=blogdetail&sharerId=151073877&sharerefer=PC&sharesource=2301_81554020&spm=1011.2480.3001.8118) |
| Github仓库地址？     | [ChenFirstIce/Mobile-software-development-for-the-summer-semester-of-2025: OUC-2025夏季学期《移动软件开发》课程的六个实验以及个人项目的课程报告以及代码。主要是使用微信小程序开发工具开发微信小程序，并涉及到一点鸿蒙系统。](https://github.com/ChenFirstIce/Mobile-software-development-for-the-summer-semester-of-2025/tree/main) |

（备注：将实验报告发布在博客、代码公开至 github 是 **加分项**，不是必须做的）



## **一、实验目标**

学习微信小程序云开发的基础知识。能够完成利用文本搜索的功能就好，图像识别、语音识别接口有时有问题，不强求。

## 二、实验步骤

### 2.1 前期准备

1. #### 创建云开发项目

   - 从gitee上拉取代码

     - 体现下载好git

     - 输入以下配置

       ```
       git config --global user.name userName 
       git config --global user.email userEmail
       ```

     - 使用`git clone https://gitee.com/xxwan/garbage-sorting-applet.git`拉取代码

     ![](\images\200eea35fca59406c610d7fedd5a673e.png)

   - 使用微信开发工具打开该项目，注册APPID，将选项改成云开发

   - 视情况更改基础库版本

     <img src="\images\af6a330e50baae41d06e4530e9d0847f.png" style="zoom: 50%;" />

2. #### 获取百度智能云的图像识别的应用

   - 在[百度智能云](https://login.bce.baidu.com/?account=&redirect=http%3A%2F%2Fconsole.bce.baidu.com%2Fai%2F%3F_%3D%26fromai%3D1#/ai/imagerecognition/app/create)创建一个图像识别应用

     ![](\images\027a3e6280730cc6c555e1a327555fbf.png)

   - 得到`API key`和`Secret Key`

     ![](\images\d2ad6fb189413febb70d97eb16525f1d.png)

### 2.2 云开发部署

1. #### 修改配置

   - 修改`app.js`的`env`=环境ID；环境ID的位置在云开发界面的右上角

     ![](\images\91333dde206a49c5ae276ca88b696a3a.png)

   - 修改`project.config.json`中的`appid`=注册的APPID

     <img src="images\af6a330e50baae41d06e4530e9d0847f.png" style="zoom:50%;" />

   - 修改`pages/search/search.js`中的`appisecret`=`API key`，`appkey`=`Secret Key`

     ![39d8dbcf71ca9b28f905881e1cefe314](images\39d8dbcf71ca9b28f905881e1cefe314.png)

2. #### 部署云函数

   - 提前将`cloudfunctions`的环境修改为**当前云开发环境**。（一般直接拉取文件再从微信开发工具直接打开项目文件夹是没有问题的，但是复制黏贴`cloudfunctions`文件夹会出现**环境未选择**的问题）

     <img src="\images\87fea09ca1bb0515da127d1575d01d25.png" style="zoom:50%;" />

   - 右击`cloudfunctions`云函数下的所有子文件点击**上传并部署(不上传node_modules)**，将所有函数都部署到云上。

     <img src="\images\4797bc5210b785cb5db9d63a3cded38b.png" style="zoom:50%;" />

     <img src="\images\61128d5e2648e974e94d9c1d20ffd09e.png" style="zoom:50%;" />

3. #### 部署云数据库

   - 点击小程序开发工具**云开发** ->**数据库**，依次创建`trash`、`type`并以此导入`trash.json`、`type.json`

     <img src="\images\21d0b73ec8aaecc52b035d9163c5c21f.png" style="zoom: 50%;" />

     <img src="\images\44d9fcec381cfe4cb8b2d9f93128998a.png" style="zoom: 50%;" />

## 三、程序运行结果

- 首页

  <img src="\images\b805b9300f89797e8d4c53472a979570.jpg" style="zoom: 25%;" />

- 热词

  <img src="\images\1b69c7fb854e0793030b809a38b96586.jpg" style="zoom:25%;" />

- 文字搜索

  <img src="\images\92cf2d42c7c1f092474feca1d41dbe00.jpg" style="zoom: 25%;" />

- 图片识别
<center class='half'>
    <img src="\images\6a663b0a21789d1280ff08a2456e8233.jpg" style="zoom:25%;" />
    <img src="\images\675b46a53113d33dd6bf3899e98c9d9d.png" style="zoom:50%;" />
</center>

## 四、问题总结与体会

#### 问题1：图像的选择没有处理用户取消后操作

![](\images\b82b6df52358f297fb53b777aeea8968.png)

#### 解决方案1：

​	对`chooseImage`函数进行补写处理操作`.catch`

```java
  doClickCamera: function () {
    var that = this;

    //复位扫描的项目
    that.setData({
      scanItems: null
    })

    // //首先授权相机的使用
    that.checkAuth().then(res => {
      console.log(res);
    })

    //获取BaiduTaken
    if (!that.baiduToken) {
      that.getBaiduTaken();
    }
    that.getImage().then(res => {
      //原处理代码
        },
        fail: res => {
         //
        }
      })
    })
    //补充代码
    .catch(err => {
      if(err.errMsg.includes('cancel')){
        console.log('用户取消图片选择')
        wx.showToast({
          title: '已取消选择',
          icon: 'none',
          duration: 1000
        })
      }
    })
  },
```



#### 问题2：用户无法设置授权

​	源代码只能提示“用户拒绝授权”以及“可点击右上角进行设置”。

​	![](\images\38adaf3685eea40e37603e372046096e.png)

#### 解决方案：

​	当用户拒绝授权的时候，直接弹出设置窗口。

```java
  checkAuth: function () {
    return new Promise(function (resolve, reject) {
      wx.getSetting({
        success: res => {
          if (!res.authSetting['scope.camera']) {
            // 没有授权，尝试请求授权
            wx.authorize({
              scope: 'scope.camera',
              success: res => {
                console.log("用户同意授权")
                resolve(res)
              },
              fail: () => {
                console.log("用户拒绝授权")
                // 弹窗提示用户去设置
                wx.showModal({
                  title: '权限不足',
                  content: '未开启拍照权限，是否前往设置开启？',
                  confirmText: '去设置',
                  cancelText: '取消',
                  success: (modalRes) => {
                    if (modalRes.confirm) {
                      wx.openSetting({
                        success: (settingRes) => {
                          if (settingRes.authSetting['scope.camera']) {
                            resolve(settingRes)
                          } else {
                            reject('用户未开启相机权限')
                          }
                        },
                        fail: reject
                      })
                    } else {
                      reject('用户拒绝去设置')
                    }
                  }
                })
              }
            })
          } else {
            console.log("用户已经授权")
            resolve(res)
          }
        },
        fail: reject
      })
    })
  },
```

​	最终效果如下：
<center class='half'>
    <img src="\images\6eb0f237f0c7f7ba364e86544cf9ec37.png" style="zoom:33%;" />
    <img src="\images\83436e98fba1463649251a1136d644e7.png" style="zoom: 50%;" />
</center>



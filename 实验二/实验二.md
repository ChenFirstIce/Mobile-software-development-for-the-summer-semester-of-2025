# 2025年夏季《移动软件开发》实验报告



<center>姓名：陈怡冰  学号：23020007007</center>

| 姓名和学号？         | 陈怡冰，23020007007                                          |
| -------------------- | ------------------------------------------------------------ |
| 本实验属于哪门课程？ | 中国海洋大学25夏《移动软件开发》                             |
| 实验名称？           | 实验2：天气查询小程序                                        |
| 博客地址？           | [OUC-2025年夏季《移动软件开发》实验报告-实验二-CSDN博客](https://blog.csdn.net/2301_81554020/article/details/150873174?sharetype=blogdetail&sharerId=150873174&sharerefer=PC&sharesource=2301_81554020&spm=1011.2480.3001.8118) |
| Github仓库地址？     | [ChenFirstIce/Mobile-software-development-for-the-summer-semester-of-2025: OUC-2025夏季学期《移动软件开发》课程的六个实验以及个人项目的课程报告以及代码。主要是使用微信小程序开发工具开发微信小程序，并涉及到一点鸿蒙系统。](https://github.com/ChenFirstIce/Mobile-software-development-for-the-summer-semester-of-2025/tree/main) |

（备注：将实验报告发布在博客、代码公开至 github 是 **加分项**，不是必须做的）



## **一、实验目标**

 1、学习使用快速启动模板创建小程序的方法；

2、学习不使用模板手动创建小程序的方法。

## 二、实验步骤

### 2.1 准备工作

1. **和风天气API身份认证**

   - 在“项目管理”的界面创建项目，我这里是"移动软件开发"

     <img src="images\f396d077a4e57f3c42005bc1b908ab3f.png" alt="f396d077a4e57f3c42005bc1b908ab3f" style="zoom:33%;" />

   - 创建成功后，点击添加凭据，并选择身份认证方式为**API KEY**

     <img src="images\c3dc57acb96a16c91bd0da1ba7127043.png" alt="c3dc57acb96a16c91bd0da1ba7127043" style="zoom:33%;" />

   - 并记录下**开发者信息**界面的**API HOST** *（后续会放在博客上，为保障个人信息直接打码了）*，这个**API HOST**是后面查询天气和城市ID查询的**request地址的域名**。

     **<img src="images\e9a35e6b973225809253a878232d9079.png" alt="e9a35e6b973225809253a878232d9079" style="zoom:33%;" />**

   - 已知**API KEY**和**API HOST**，首先通过中断指令验证整个身份认证的过程是否成功，方便后面可以直接排除该错误。

     直接使用官网文档给出的命令进行验证。

     ```shell
     curl --compressed \
     'https://api_host/v7/weather/now?location=101010100&key=api_key'
     ```

     很明显，`key`和`域名`需要改成自己的**API KEY**和**API HOST**

     ![95ea20d69ff1b9334d7fbc110cbf62dc](images\95ea20d69ff1b9334d7fbc110cbf62dc.png)

2. **服务器域名的配置**

   - 每一个小程序与指定的域名网址进行网络通信前都必须将域名地址添加到管理员的白名单中。

   - 进入[微信小程序管理员后台](https://mp.weixin.qq.com)选择**管理**中的**开发管理**，下滑即可看到**服务器域名**，然后点击修改即可。

     ![e6499fa76238370ebcfa9133216f3a46](images\e6499fa76238370ebcfa9133216f3a46.png)

   - 经过身份认证后，把自己`https://{{API HOST}}`放进去即可。

     ![8a9c1684801ed7b346142533f7bbd5de](images\8a9c1684801ed7b346142533f7bbd5de.png)

### 2.2 项目创建

​	和实验一的方法一致，不再赘述。主要是image是从下载好的图片demo压缩包中选择了一套放进去的，最后的项目结构如图所示。

<img src="images\28c5d6a7491635e05d00ff2fb5e1cdbd.png" alt="28c5d6a7491635e05d00ff2fb5e1cdbd" style="zoom: 33%;" />

### 2.3 视图设计

1. 根据文档对文档进行设计，将页面设计为四个区域，其功能分别为：

   - 区域1：选择城市
   - 区域2：显示最主要的温度和天气状况（单行）
   - 区域3：显示与天气状况对应的图标（单行）
   - 区域4：分多行显示其他天气信息

2. 其中有以下组件：

   - 整体页面：[view] 的 `container` 类
   - 区域1：[picker]是一个类似下拉栏的动态组件，可直接使用自带模式`region`
   - 区域2：[text]主要是显示
   - 区域3：[image]主要是显示
   - 区域4：[view]并定义一个子类 `detail`
     - 单元行：[view] 孙类 `bar`
       - 单元格：[view]曾孙类 `box`

   ```html
   <view class='container'>
     <!--区域1：选择区域-->
     <picker mode='region' bindchange="regionChange">
       <view>北京市</view>
     </picker>
     <!--区域2：天气信息-单行-->
     <text>19℃ 晴</text>
     <!--区域3：天气图标-->
     <image src='/images/{{now.icon}}.png' mode='widthFix'></image>
     <!--区域4：天气信息-多行-->
     <view class="detail">
       <view class="bar">
         <view class="box">温度</view>
         <view class="box">气压</view>
         <view class="box">能见度</view>
       </view>
       <view class="bar">
         <view class="box">0 %</view>
         <view class="box">0 hPa</view>
         <view class="box">0 km</view>
       </view>
       <view class="bar">
         <view class="box">0</view>
         <view class="box">0 km/h</view>
         <view class="box">0 级</view>
       </view>
     </view>
   </view>
   ```

   

3. 然后在`index.wxss`中设置容器的样式

   ```css
   .container{
     height: 100vh;
     display: flex;
     flex-direction: column;
     align-items: center;
     justify-content: space-around;
   }
   text{
     font-size: 80rpx;
     color: #3C5F81;
   }
   
   image{
     width: 220rpx;
   }
   
   .detail{
     width: 100%;
     display: flex;
     flex-direction: column;
   }
   
   .bar{
     display: flex;
     flex-direction: row;
     margin: 20rpx 0;
   }
   
   .box{
     width: 33.3%;
     text-align: center;
   }
   ```

<img src="images\11fa75f56fc11a2b226a62fc6ba9f5ad.png" alt="11fa75f56fc11a2b226a62fc6ba9f5ad" style="zoom:33%;" />

### 2.4 逻辑实现

1. `data`的结构

```
Page({
  data: {
    region: ['山东省', '青岛市', '黄岛区'], // 默认地区
    location: '', 
    id: , 
    now: ''
  },
```

2. `regionChange`：更新城市信息，并跳转到`getWeather`函数中

```javascript
  regionChange: function(e) {
    this.setData({
      region: e.detail.value 
    });
    this.getWeather();
  }
```

3. `getLocationId`：获取城市ID，将**region**的信息通过[geoapi](https://dev.qweather.com/docs/api/geoapi/)转换为城市id

> [!NOTE]
>
> 该逻辑在文档中并没有写明，且很容易有人把这个`url`域名后面的部分写错`/geo/v2/city/lookup`

```javascript
  getLocationId: function() {
    let that = this;
    wx.request({
      url: 'https://api host/geo/v2/city/lookup',
      data: {
        location: that.data.region, 
        key: 'apikey' 
      },

      success(res) {
        console.log(res.data.location[0].id)
        that.setData({
          id: res.data.location[0].id 
        });
      }
    });
  },
```

4. `getWeather`：通过获取到的城市id（存储在id参数中），通过api进行该城市的天气查询，将所有放回的结果存储在**now**中

```javascript
  getWeather: function() {
    let that = this;
    that.getLocationId();
    wx.request({
      url: 'https://api host/v7/weather/now',
      data: {
        location: that.data.id, 
        key: 'apikey' 
      },
      success(res) {
        console.log(res.data.now)
        that.setData({
          now: res.data.now 
        });
      }
    });
  },
```

### 2.5 更新天气信息

1. 主要是将静态的`index.wxml`中的信息都修改成可根据城市的不同而变化的动态页面。

   其中**now**变量存储了所有参数，可根据[实时天气api](https://dev.qweather.com/docs/api/weather/weather-now/)中的**返回数据**中对返回数据的描述将相应的静态变量修改为`{{now.属性}}`这样的动态变量。

   > [!CAUTION]
   >
   > 实验文档中的相关属性名称已经是过时版本，具体属性名称和用途应该参照api官方文档

   ```html
   <view class='container'>
     <!--区域1：选择区域-->
     <picker mode='region' bindchange="regionChange">
       <view>{{region}}</view>
     </picker>
     <!--区域2：天气信息-单行-->
     <text>{{now.temp}}℃ {{now.text}}</text>
     <!--区域3：天气图标-->
     <image src='/images/{{now.icon}}.png' mode='widthFix'></image>
     <!--区域4：天气信息-多行-->
     <view class="detail">
       <view class="bar">
         <view class="box">温度</view>
         <view class="box">气压</view>
         <view class="box">能见度</view>
       </view>
       <view class="bar">
         <view class="box">{{now.humidity}} %</view>
         <view class="box">{{now.pressure}} hPa</view>
         <view class="box">{{now.vis}} km</view>
       </view>
       <view class="bar">
         <view class="box">{{now.windDir}}</view>
         <view class="box">{{now.windSpeed}} km/h</view>
         <view class="box">{{now.windScale}} 级</view>
       </view>
     </view>
   </view>
   ```

   

## 三、程序运行结果

真机预览效果

<img src="images\c8efa4828c53641fee7763caa02351c0.jpg" alt="c8efa4828c53641fee7763caa02351c0" style="zoom:33%;" />

<img src="images\301e1ee5e2e99d6eb021c67d2cd9ed06.jpg" alt="301e1ee5e2e99d6eb021c67d2cd9ed06" style="zoom:33%;" />

<img src="images\238e8df810e3825333719acc2f522aac.jpg" alt="238e8df810e3825333719acc2f522aac" style="zoom:33%;" />

## 四、问题总结与体会

### 问题一：小程序无法与指定的域名网址进行网络通信

按理来说服务器配置过后就是可以的，但是，我配置了以后开发工具上依旧显示无配置，即使我已经清理缓存了。

<img src="images\d705a7d929c4f66510da87b24d6a86ec.png" alt="d705a7d929c4f66510da87b24d6a86ec" style="zoom:33%;" />

### 解决方案

直接在**本地设置**中选择**不校验合法域名**。

<img src="images\e4e7858da16f98f3a5f97231083b054d.png" alt="e4e7858da16f98f3a5f97231083b054d" style="zoom:25%;" />

### 体会

这次更加熟悉各个文件的具体用途，而且通过编写这次稍微复杂的后台逻辑能够更明白的了解`data`是啥，以及学会如何使用api和**查看api相关的官方文档**，然后就可以自己一个人愉快的玩耍了。
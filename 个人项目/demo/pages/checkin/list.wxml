<!--pages/checkin/list.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">æˆ‘çš„æ‰“å¡</text>
    <text class="page-subtitle">è®°å½•ç¾å¥½æ—¶å…‰</text>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-section">
    <view class="stats-item">
      <text class="stats-number">{{stats.total}}</text>
      <text class="stats-label">æ€»æ‰“å¡</text>
    </view>
    <view class="stats-item">
      <text class="stats-number">{{stats.public}}</text>
      <text class="stats-label">å…¬å¼€</text>
    </view>
    <view class="stats-item">
      <text class="stats-number">{{stats.recent}}</text>
      <text class="stats-label">è¿‘7å¤©</text>
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-section">
    <view class="filter-tabs">
      <view class="filter-tab {{filterType === 'all' ? 'active' : ''}}" 
            bindtap="switchFilterType" data-type="all">
        å…¨éƒ¨
      </view>
      <view class="filter-tab {{filterType === 'public' ? 'active' : ''}}" 
            bindtap="switchFilterType" data-type="public">
        å…¬å¼€
      </view>
      <view class="filter-tab {{filterType === 'private' ? 'active' : ''}}" 
            bindtap="switchFilterType" data-type="private">
        ç§å¯†
      </view>
    </view>
    <view class="filter-actions">
      <button class="filter-btn" bindtap="showFilter">
        <image class="filter-icon" src="/images/search.png"></image>
        ç­›é€‰
      </button>
    </view>
  </view>

  <!-- æ‰“å¡åˆ—è¡¨ -->
  <view class="checkin-list">
    <view class="checkin-item" wx:for="{{checkins}}" wx:key="_id" 
          bindtap="viewCheckinDetail" data-id="{{item._id}}">
      <!-- æ‰“å¡å¤´éƒ¨ -->
      <view class="checkin-header">
        <view class="user-info">
          <image class="user-avatar" src="{{item.userAvatar || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="user-details">
            <text class="user-name">{{item.userName}}</text>
            <text class="checkin-time">{{item.createTime}}</text>
          </view>
        </view>
        <view class="checkin-actions">
          <button class="action-btn" bindtap="editCheckin" data-id="{{item._id}}" catchtap="stopPropagation">
            <text class="action-icon">âœï¸</text>
          </button>
          <button class="action-btn" bindtap="deleteCheckin" data-id="{{item._id}}" catchtap="stopPropagation">
            <text class="action-icon">ğŸ—‘ï¸</text>
          </button>
        </view>
      </view>

      <!-- ä½ç½®ä¿¡æ¯ -->
      <view class="location-info">
        <text class="location-icon">ğŸ“</text>
        <text class="location-text">{{item.address}}</text>
      </view>

      <!-- æ‰“å¡å†…å®¹ -->
      <view class="checkin-content" wx:if="{{item.content}}">
        <text class="content-text">{{item.content}}</text>
      </view>

      <!-- ç…§ç‰‡å±•ç¤º -->
      <view class="photo-gallery" wx:if="{{item.photos && item.photos.length > 0}}">
        <view class="photo-grid">
          <image class="photo-item" 
                 wx:for="{{item.photos}}" 
                 wx:for-item="photo" 
                 wx:key="index"
                 src="{{photo}}" 
                 mode="aspectFill"
                 bindtap="previewPhoto" 
                 data-photos="{{item.photos}}" 
                 data-index="{{index}}"
                 catchtap="stopPropagation"></image>
        </view>
      </view>

      <!-- æ ‡ç­¾ -->
      <view class="tags-section" wx:if="{{item.tags && item.tags.length > 0}}">
        <view class="tag-item" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="index">
          {{tag}}
        </view>
      </view>

      <!-- ç›¸å†Œä¿¡æ¯ -->
      <view class="album-info" wx:if="{{item.albumName}}">
        <text class="album-icon">ğŸ“</text>
        <text class="album-text">å·²ä¿å­˜åˆ° {{item.albumName}}</text>
      </view>

      <!-- äº’åŠ¨ä¿¡æ¯ -->
      <view class="interaction-info">
        <view class="interaction-item">
          <text class="interaction-icon">â¤ï¸</text>
          <text class="interaction-count">{{item.likeCount || 0}}</text>
        </view>
        <view class="interaction-item">
          <text class="interaction-icon">ğŸ’¬</text>
          <text class="interaction-count">{{item.commentCount || 0}}</text>
        </view>
        <view class="privacy-badge {{item.privacy}}">
          {{item.privacy === 'public' ? 'å…¬å¼€' : 'ç§å¯†'}}
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{checkins.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-title">è¿˜æ²¡æœ‰æ‰“å¡è®°å½•</text>
      <text class="empty-desc">å»è®°å½•ä½ çš„ç¾å¥½æ—¶å…‰å§</text>
      <button class="btn-primary" bindtap="goToCheckin">å¼€å§‹æ‰“å¡</button>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore && !loading && checkins.length > 0}}">
      <button class="load-more-btn" bindtap="loadMore">åŠ è½½æ›´å¤š</button>
    </view>
  </view>

  <!-- ç­›é€‰å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showFilterModal}}" bindtap="hideFilter">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç­›é€‰æ¡ä»¶</text>
        <text class="modal-close" bindtap="hideFilter">Ã—</text>
      </view>
      
      <view class="modal-body">
        <!-- æ ‡ç­¾ç­›é€‰ -->
        <view class="filter-group">
          <text class="filter-label">æ ‡ç­¾ç­›é€‰</text>
          <view class="tag-list">
            <view class="tag-item {{item.selected ? 'selected' : ''}}" 
                  wx:for="{{availableTags}}" 
                  wx:key="name"
                  bindtap="toggleTag" 
                  data-index="{{index}}">
              {{item.name}}
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="clearFilter">æ¸…é™¤</button>
        <button class="btn-primary" bindtap="applyFilter">åº”ç”¨</button>
      </view>
    </view>
  </view>
</view>

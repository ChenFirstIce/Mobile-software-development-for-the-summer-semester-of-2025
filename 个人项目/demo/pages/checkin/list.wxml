<!--pages/checkin/list.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">我的打卡</text>
    <text class="page-subtitle">记录美好时光</text>
  </view>

  <!-- 统计信息 -->
  <view class="stats-section">
    <view class="stats-item">
      <text class="stats-number">{{stats.total}}</text>
      <text class="stats-label">总打卡</text>
    </view>
    <view class="stats-item">
      <text class="stats-number">{{stats.public}}</text>
      <text class="stats-label">公开</text>
    </view>
    <view class="stats-item">
      <text class="stats-number">{{stats.recent}}</text>
      <text class="stats-label">近7天</text>
    </view>
  </view>

  <!-- 筛选栏 -->
  <view class="filter-section">
    <view class="filter-tabs">
      <view class="filter-tab {{filterType === 'all' ? 'active' : ''}}" 
            bindtap="switchFilterType" data-type="all">
        全部
      </view>
      <view class="filter-tab {{filterType === 'public' ? 'active' : ''}}" 
            bindtap="switchFilterType" data-type="public">
        公开
      </view>
      <view class="filter-tab {{filterType === 'private' ? 'active' : ''}}" 
            bindtap="switchFilterType" data-type="private">
        私密
      </view>
    </view>
    <view class="filter-actions">
      <button class="filter-btn" bindtap="showFilter">
        <image class="filter-icon" src="/images/search.png"></image>
        筛选
      </button>
    </view>
  </view>

  <!-- 打卡列表 -->
  <view class="checkin-list">
    <view class="checkin-item" wx:for="{{checkins}}" wx:key="_id" 
          bindtap="viewCheckinDetail" data-id="{{item._id}}">
      <!-- 打卡头部 -->
      <view class="checkin-header">
        <view class="user-info">
          <image class="user-avatar" src="{{item.userAvatar || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="user-details">
            <text class="user-name">{{item.userName}}</text>
            <text class="checkin-time">{{item.createTime}}</text>
          </view>
        </view>
        <view class="checkin-actions">
          <button class="action-btn" bindtap="editCheckin" data-id="{{item._id}}" catchtap="stopPropagation">
            <text class="action-icon">✏️</text>
          </button>
          <button class="action-btn" bindtap="deleteCheckin" data-id="{{item._id}}" catchtap="stopPropagation">
            <text class="action-icon">🗑️</text>
          </button>
        </view>
      </view>

      <!-- 位置信息 -->
      <view class="location-info">
        <text class="location-icon">📍</text>
        <text class="location-text">{{item.address}}</text>
      </view>

      <!-- 打卡内容 -->
      <view class="checkin-content" wx:if="{{item.content}}">
        <text class="content-text">{{item.content}}</text>
      </view>

      <!-- 照片展示 -->
      <view class="photo-gallery" wx:if="{{item.photos && item.photos.length > 0}}">
        <view class="photo-grid">
          <image class="photo-item" 
                 wx:for="{{item.photos}}" 
                 wx:for-item="photo" 
                 wx:key="index"
                 src="{{photo}}" 
                 mode="aspectFill"
                 bindtap="previewPhoto" 
                 data-photos="{{item.photos}}" 
                 data-index="{{index}}"
                 catchtap="stopPropagation"></image>
        </view>
      </view>

      <!-- 标签 -->
      <view class="tags-section" wx:if="{{item.tags && item.tags.length > 0}}">
        <view class="tag-item" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="index">
          {{tag}}
        </view>
      </view>

      <!-- 相册信息 -->
      <view class="album-info" wx:if="{{item.albumName}}">
        <text class="album-icon">📁</text>
        <text class="album-text">已保存到 {{item.albumName}}</text>
      </view>

      <!-- 互动信息 -->
      <view class="interaction-info">
        <view class="interaction-item">
          <text class="interaction-icon">❤️</text>
          <text class="interaction-count">{{item.likeCount || 0}}</text>
        </view>
        <view class="interaction-item">
          <text class="interaction-icon">💬</text>
          <text class="interaction-count">{{item.commentCount || 0}}</text>
        </view>
        <view class="privacy-badge {{item.privacy}}">
          {{item.privacy === 'public' ? '公开' : '私密'}}
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{checkins.length === 0 && !loading}}">
      <text class="empty-icon">📝</text>
      <text class="empty-title">还没有打卡记录</text>
      <text class="empty-desc">去记录你的美好时光吧</text>
      <button class="btn-primary" bindtap="goToCheckin">开始打卡</button>
    </view>

    <!-- 加载状态 -->
    <view class="loading-state" wx:if="{{loading}}">
      <text class="loading-text">加载中...</text>
    </view>

    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{hasMore && !loading && checkins.length > 0}}">
      <button class="load-more-btn" bindtap="loadMore">加载更多</button>
    </view>
  </view>

  <!-- 筛选弹窗 -->
  <view class="modal-overlay" wx:if="{{showFilterModal}}" bindtap="hideFilter">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">筛选条件</text>
        <text class="modal-close" bindtap="hideFilter">×</text>
      </view>
      
      <view class="modal-body">
        <!-- 标签筛选 -->
        <view class="filter-group">
          <text class="filter-label">标签筛选</text>
          <view class="tag-list">
            <view class="tag-item {{item.selected ? 'selected' : ''}}" 
                  wx:for="{{availableTags}}" 
                  wx:key="name"
                  bindtap="toggleTag" 
                  data-index="{{index}}">
              {{item.name}}
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="clearFilter">清除</button>
        <button class="btn-primary" bindtap="applyFilter">应用</button>
      </view>
    </view>
  </view>
</view>

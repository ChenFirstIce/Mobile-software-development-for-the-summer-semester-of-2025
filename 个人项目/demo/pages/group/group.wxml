<!--pages/group/group.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="top-bar">
    <view class="search-box">
      <input class="search-input" placeholder="æœç´¢æ—…æ¸¸ç¾¤..." bindinput="onSearchInput" value="{{searchKeyword}}" />
      <view class="search-icon">ğŸ”</view>
    </view>
    <button class="btn-primary" bindtap="createGroup">åˆ›å»ºç¾¤ç»„</button>
  </view>

  <!-- ç¾¤ç»„ç±»å‹åˆ‡æ¢ -->
  <view class="group-tabs">
    <view class="tab-item {{currentType === 'all' ? 'active' : ''}}" bindtap="switchType" data-type="all">
      <text class="tab-text">å…¨éƒ¨</text>
    </view>
    <view class="tab-item {{currentType === 'my' ? 'active' : ''}}" bindtap="switchType" data-type="my">
      <text class="tab-text">æˆ‘çš„ç¾¤ç»„</text>
    </view>
    <view class="tab-item {{currentType === 'joined' ? 'active' : ''}}" bindtap="switchType" data-type="joined">
      <text class="tab-text">å·²åŠ å…¥</text>
    </view>
  </view>

  <!-- ç¾¤ç»„åˆ†ç»„åˆ—è¡¨ -->
  <view class="group-sections" wx:if="{{filteredGroups.length > 0}}">
    <!-- æˆ‘çš„ç¾¤ç»„åˆ†ç»„ -->
    <view class="group-section" wx:if="{{myGroups.length > 0}}">
      <view class="section-header" bindtap="toggleSection" data-section="my">
        <view class="section-title">
          <text class="section-icon">ğŸ‘‘</text>
          <text>æˆ‘åˆ›å»ºçš„ç¾¤ç»„</text>
          <view class="section-count">{{myGroups.length}}</view>
        </view>
        <view class="section-toggle">{{expandedSections.my ? 'æ”¶èµ·' : 'å±•å¼€'}}</view>
      </view>
      <view class="group-list" wx:if="{{expandedSections.my}}">
        <view class="group-item" wx:for="{{myGroups}}" wx:key="id" bindtap="openGroup" data-id="{{item.id}}">
          <view class="group-avatar">
            <image wx:if="{{item.avatar}}" src="{{item.avatar}}" mode="aspectFill" class="avatar-image"></image>
            <view wx:else class="avatar-placeholder">
              <text class="placeholder-icon">ğŸ‘¥</text>
            </view>
            <view class="group-status {{item.status}}">
              {{item.status === 'active' ? 'æ´»è·ƒ' : 'å¾…å®¡æ ¸'}}
            </view>
          </view>
          
          <view class="group-info">
            <view class="group-header">
              <text class="group-name">{{item.name}}</text>
              <view class="group-actions">
                <view class="action-btn" catchtap="editGroup" data-id="{{item.id}}">
                  <text class="action-icon">âœï¸</text>
                </view>
                <view class="action-btn" catchtap="deleteGroup" data-id="{{item.id}}">
                  <text class="action-icon">ğŸ—‘ï¸</text>
                </view>
              </view>
            </view>
            
            <text class="group-desc">{{item.description || 'æš‚æ— æè¿°'}}</text>
            
            <view class="group-stats">
              <view class="stat-item">
                <text class="stat-icon">ğŸ‘¥</text>
                <text class="stat-text">{{item.memberCount}}/{{item.maxMembers}}äºº</text>
              </view>
              <view class="stat-item">
                <text class="stat-icon">ğŸ“…</text>
                <text class="stat-text">{{item.createTime}}</text>
              </view>
              <view class="stat-item">
                <text class="stat-icon">ğŸ”‘</text>
                <text class="stat-text">æˆ¿é—´å·: {{item.roomCode}}</text>
              </view>
            </view>
            
            <view class="group-features">
              <view class="feature-tag" wx:if="{{item.hasAlbum}}">ğŸ“· ç›¸å†Œ</view>
              <view class="feature-tag" wx:if="{{item.hasWheel}}">ğŸ² è½®ç›˜</view>
              <view class="feature-tag" wx:if="{{item.hasVote}}">ğŸ“Š æŠ•ç¥¨</view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å·²åŠ å…¥çš„ç¾¤ç»„åˆ†ç»„ -->
    <view class="group-section" wx:if="{{joinedGroups.length > 0}}">
      <view class="section-header" bindtap="toggleSection" data-section="joined">
        <view class="section-title">
          <text class="section-icon">ğŸ¤</text>
          <text>æˆ‘åŠ å…¥çš„ç¾¤ç»„</text>
          <view class="section-count">{{joinedGroups.length}}</view>
        </view>
        <view class="section-toggle">{{expandedSections.joined ? 'æ”¶èµ·' : 'å±•å¼€'}}</view>
      </view>
      <view class="group-list" wx:if="{{expandedSections.joined}}">
        <view class="group-item" wx:for="{{joinedGroups}}" wx:key="id" bindtap="openGroup" data-id="{{item.id}}">
          <view class="group-avatar">
            <image wx:if="{{item.avatar}}" src="{{item.avatar}}" mode="aspectFill" class="avatar-image"></image>
            <view wx:else class="avatar-placeholder">
              <text class="placeholder-icon">ğŸ‘¥</text>
            </view>
            <view class="group-status {{item.status}}">
              {{item.status === 'active' ? 'æ´»è·ƒ' : 'å¾…å®¡æ ¸'}}
            </view>
          </view>
          
          <view class="group-info">
            <view class="group-header">
              <text class="group-name">{{item.name}}</text>
              <view class="group-actions">
                <view class="action-btn" catchtap="editGroup" data-id="{{item.id}}">
                  <text class="action-icon">âœï¸</text>
                </view>
                <view class="action-btn" catchtap="deleteGroup" data-id="{{item.id}}">
                  <text class="action-icon">ğŸ—‘ï¸</text>
                </view>
              </view>
            </view>
            
            <text class="group-desc">{{item.description || 'æš‚æ— æè¿°'}}</text>
            
            <view class="group-stats">
              <view class="stat-item">
                <text class="stat-icon">ğŸ‘¥</text>
                <text class="stat-text">{{item.memberCount}}/{{item.maxMembers}}äºº</text>
              </view>
              <view class="stat-item">
                <text class="stat-icon">ğŸ“…</text>
                <text class="stat-text">{{item.createTime}}</text>
              </view>
              <view class="stat-item">
                <text class="stat-icon">ğŸ”‘</text>
                <text class="stat-text">æˆ¿é—´å·: {{item.roomCode}}</text>
              </view>
            </view>
            
            <view class="group-features">
              <view class="feature-tag" wx:if="{{item.hasAlbum}}">ğŸ“· ç›¸å†Œ</view>
              <view class="feature-tag" wx:if="{{item.hasWheel}}">ğŸ² è½®ç›˜</view>
              <view class="feature-tag" wx:if="{{item.hasVote}}">ğŸ“Š æŠ•ç¥¨</view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å…¶ä»–ç¾¤ç»„åˆ†ç»„ -->
    <view class="group-section" wx:if="{{otherGroups.length > 0}}">
      <view class="section-header" bindtap="toggleSection" data-section="other">
        <view class="section-title">
          <text class="section-icon">ğŸŒ</text>
          <text>å‘ç°æ›´å¤šç¾¤ç»„</text>
          <view class="section-count">{{otherGroups.length}}</view>
        </view>
        <view class="section-toggle">{{expandedSections.other ? 'æ”¶èµ·' : 'å±•å¼€'}}</view>
      </view>
      <view class="group-list" wx:if="{{expandedSections.other}}">
        <view class="group-item" wx:for="{{otherGroups}}" wx:key="id" bindtap="openGroup" data-id="{{item.id}}">
          <view class="group-avatar">
            <image wx:if="{{item.avatar}}" src="{{item.avatar}}" mode="aspectFill" class="avatar-image"></image>
            <view wx:else class="avatar-placeholder">
              <text class="placeholder-icon">ğŸ‘¥</text>
            </view>
            <view class="group-status {{item.status}}">
              {{item.status === 'active' ? 'æ´»è·ƒ' : 'å¾…å®¡æ ¸'}}
            </view>
          </view>
          
          <view class="group-info">
            <view class="group-header">
              <text class="group-name">{{item.name}}</text>
              <view class="group-actions">
                <view class="action-btn" catchtap="editGroup" data-id="{{item.id}}">
                  <text class="action-icon">âœï¸</text>
                </view>
                <view class="action-btn" catchtap="deleteGroup" data-id="{{item.id}}">
                  <text class="action-icon">ğŸ—‘ï¸</text>
                </view>
              </view>
            </view>
            
            <text class="group-desc">{{item.description || 'æš‚æ— æè¿°'}}</text>
            
            <view class="group-stats">
              <view class="stat-item">
                <text class="stat-icon">ğŸ‘¥</text>
                <text class="stat-text">{{item.memberCount}}/{{item.maxMembers}}äºº</text>
              </view>
              <view class="stat-item">
                <text class="stat-icon">ğŸ“…</text>
                <text class="stat-text">{{item.createTime}}</text>
              </view>
              <view class="stat-item">
                <text class="stat-icon">ğŸ”‘</text>
                <text class="stat-text">æˆ¿é—´å·: {{item.roomCode}}</text>
              </view>
            </view>
            
            <view class="group-features">
              <view class="feature-tag" wx:if="{{item.hasAlbum}}">ğŸ“· ç›¸å†Œ</view>
              <view class="feature-tag" wx:if="{{item.hasWheel}}">ğŸ² è½®ç›˜</view>
              <view class="feature-tag" wx:if="{{item.hasVote}}">ğŸ“Š æŠ•ç¥¨</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <view class="empty-icon">ğŸ‘¥</view>
    <text class="empty-title">æš‚æ— æ—…æ¸¸ç¾¤</text>
    <text class="empty-desc">åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæ—…æ¸¸ç¾¤ï¼Œé‚€è¯·æœ‹å‹ä¸€èµ·å‡ºè¡Œ</text>
    <button class="btn-primary" bindtap="createGroup">åˆ›å»ºç¾¤ç»„</button>
  </view>

  <!-- åŠ å…¥ç¾¤ç»„å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showJoinModal}}" bindtap="hideJoinModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">åŠ å…¥æ—…æ¸¸ç¾¤</text>
        <view class="close-btn" bindtap="hideJoinModal">âœ•</view>
      </view>
      
      <view class="modal-body">
        <view class="input-group">
          <text class="input-label">æˆ¿é—´å·</text>
          <input class="input-field" placeholder="è¯·è¾“å…¥6ä½æˆ¿é—´å·" bindinput="onRoomCodeInput" value="{{roomCode}}" maxlength="6" />
        </view>
        
        <view class="input-group">
          <text class="input-label">éªŒè¯ç ï¼ˆå¯é€‰ï¼‰</text>
          <input class="input-field" placeholder="è¯·è¾“å…¥éªŒè¯ç " bindinput="onVerifyCodeInput" value="{{verifyCode}}" />
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="hideJoinModal">å–æ¶ˆ</button>
        <button class="btn-primary" bindtap="joinGroup">åŠ å…¥ç¾¤ç»„</button>
      </view>
    </view>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="fab-container">
    <view class="fab tools-fab" bindtap="navigateToTools">
      <text class="fab-icon">ğŸ¯</text>
    </view>
    <view class="fab join-fab" bindtap="showJoinModal">
      <text class="fab-icon">â•</text>
    </view>
    <view class="fab create-fab" bindtap="createGroup">
      <text class="fab-icon">ğŸ‘¥</text>
    </view>
  </view>
</view>

<!--pages/group/detail.wxml-->
<view class="container">
  <!-- ç¾¤ç»„å¤´éƒ¨ -->
  <view class="group-header">
    <view class="header-background">
      <image wx:if="{{group.coverImage}}" src="{{group.coverImage}}" mode="aspectFill" class="header-bg"></image>
      <view wx:else class="header-bg-placeholder"></view>
      <view class="header-overlay"></view>
    </view>
    
    <view class="header-content">
      <view class="group-avatar">
        <image wx:if="{{group.coverImage}}" src="{{group.coverImage}}" mode="aspectFill" class="avatar-img"></image>
        <view wx:else class="avatar-placeholder">
          <text class="avatar-text">{{group.name.charAt(0)}}</text>
        </view>
      </view>
      
      <view class="group-info">
        <text class="group-name">{{group.name}}</text>
        <text class="group-desc" style="color: black">{{group.description || 'æš‚æ— æè¿°'}}</text>
        
        <view class="group-meta">
          <view class="meta-item">
            <text class="meta-icon">ğŸ‘¥</text>
            <text class="meta-text" style="color: black">{{group.memberCount}}/{{group.maxMembers}}äºº</text>
          </view>
        </view>
        
        <view class="group-tags" wx:if="{{group.tags && group.tags.length > 0}}">
          <view class="tag-item" wx:for="{{group.tags}}" wx:key="index">
            {{item}}
          </view>
        </view>
      </view>
      
      <view class="header-actions">
        <button class="action-btn primary" bindtap="joinGroup" wx:if="{{!isMember}}">
          <text class="btn-icon">â•</text>
          <text class="btn-text">åŠ å…¥ç¾¤ç»„</text>
        </button>
        <button class="action-btn" bindtap="editGroup" wx:if="{{isCreator}}">
          <text class="btn-icon">âœï¸</text>
          <text class="btn-text">ç¼–è¾‘</text>
        </button>
        <button class="action-btn" bindtap="shareGroup" wx:if="{{isMember}}">
          <text class="btn-icon">ğŸ“¤</text>
          <text class="btn-text">åˆ†äº«</text>
        </button>
      </view>
    </view>
  </view>

  <!-- ç¾¤ç»„åŠŸèƒ½ -->
  <view class="group-features" wx:if="{{isMember}}">
    <view class="features-title">ç¾¤ç»„åŠŸèƒ½</view>
    
    <view class="features-grid">
      <view class="feature-card" bindtap="openRandomWheel" wx:if="{{group.features.random}}">
        <image class="feature-icon" src="/images/wheel-of-fortune.png"></image>
        <text class="feature-name">éšæœºè½¬ç›˜</text>
        <text class="feature-desc">éšæœºé€‰æ‹©ç›®çš„åœ°</text>
      </view>
      
      <view class="feature-card" bindtap="openPriceVote" wx:if="{{group.features.priceVote}}">
        <image class="feature-icon" src="/images/money-bag.png"></image>
        <text class="feature-name">ä»·æ ¼æŠ•ç¥¨</text>
        <text class="feature-desc">é¢„æµ‹æœ€ä½ä»·</text>
      </view>
      
      <view class="feature-card" bindtap="openSharedAlbum" wx:if="{{group.features.sharedAlbum}}">
        <view class="feature-icon">ğŸ“¸</view>
        <text class="feature-name">å…±åŒç›¸å†Œ</text>
        <text class="feature-desc">{{hasSharedAlbum ? 'æŸ¥çœ‹ç›¸å†Œ' : 'åˆ›å»ºç›¸å†Œ'}}</text>
      </view>
      
      <view class="feature-card" bindtap="openMapCheckin" wx:if="{{group.features.mapCheckin}}">
        <view class="feature-icon">ğŸ—ºï¸</view>
        <text class="feature-name">åœ°å›¾æ‰“å¡</text>
        <text class="feature-desc">ä½ç½®åˆ†äº«</text>
      </view>
    </view>
  </view>

  <!-- æˆå‘˜åˆ—è¡¨ -->
  <view class="members-section">
    <view class="section-header">
      <text class="section-title">ç¾¤ç»„æˆå‘˜</text>
      <text class="member-count">{{group.memberCount}}äºº</text>
    </view>
    
    <view class="members-list">
      <view class="member-item" wx:for="{{group.members}}" wx:key="userId">
        <view class="member-avatar">
          <image wx:if="{{item.avatarUrl}}" src="{{item.avatarUrl}}" mode="aspectFill" class="member-img"></image>
          <view wx:else class="member-placeholder">
            <text class="member-text">{{item.nickName.charAt(0)}}</text>
          </view>
        </view>
        
        <view class="member-info">
          <view class="member-header">
            <text class="member-name">{{item.nickName}}</text>
            <view class="member-role">
              <text class="role-badge {{item.role}}">{{getRoleText(item.role)}}</text>
            </view>
          </view>
          <text class="member-join-time">åŠ å…¥æ—¶é—´ï¼š{{item.joinTime}}</text>
        </view>
        
        <view class="member-actions" wx:if="{{isCreator && item.role !== 'creator'}}">
          <button class="member-btn" bindtap="removeMember" data-member="{{item}}">
            <text class="btn-icon">âŒ</text>
          </button>
        </view>
      </view>
    </view>
  </view>


  <!-- ç¾¤ç»„è®¾ç½® -->
  <view class="group-settings" wx:if="{{isCreator}}">
    <view class="section-header">
      <text class="section-title">ç¾¤ç»„è®¾ç½®</text>
    </view>
    
    <view class="settings-list">
      <view class="setting-item" bindtap="editGroupInfo">
        <view class="setting-icon">ğŸ“</view>
        <text class="setting-name">ç¼–è¾‘ç¾¤ç»„ä¿¡æ¯</text>
        <text class="setting-arrow">></text>
      </view>
      
      <view class="setting-item" bindtap="manageMembers">
        <view class="setting-icon">ğŸ‘¥</view>
        <text class="setting-name">æˆå‘˜ç®¡ç†</text>
        <text class="setting-arrow">></text>
      </view>
      
      <view class="setting-item" bindtap="deleteGroup">
        <view class="setting-icon">ğŸ—‘ï¸</view>
        <text class="setting-name">è§£æ•£ç¾¤ç»„</text>
        <text class="setting-arrow">></text>
      </view>
    </view>
  </view>

  <!-- é€€å‡ºç¾¤ç»„ -->
  <view class="leave-section" wx:if="{{isMember && !isCreator}}">
    <button class="leave-btn" bindtap="leaveGroup">
      <text class="btn-icon">ğŸšª</text>
      <text class="btn-text">é€€å‡ºç¾¤ç»„</text>
    </button>
  </view>

  <!-- åŠ å…¥ç¾¤ç»„å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showJoinModal}}" bindtap="hideJoinModal">
    <view class="modal-content join-modal" >
      <view class="modal-header">
        <text class="modal-title">åŠ å…¥ç¾¤ç»„</text>
        <view class="close-btn" bindtap="hideJoinModal">âœ•</view>
      </view>
    
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="hideJoinModal">å–æ¶ˆ</button>
        <button class="btn-primary" bindtap="confirmJoin" disabled="{{!canJoin}}">
          ç¡®è®¤åŠ å…¥
        </button>
      </view>
    </view>
  </view>

  <!-- æˆå‘˜ç®¡ç†å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showMemberModal}}" bindtap="hideMemberModal">
    <view class="modal-content member-modal" >
      <view class="modal-header">
        <text class="modal-title">æˆå‘˜ç®¡ç†</text>
        <view class="close-btn" bindtap="hideMemberModal">âœ•</view>
      </view>
      
      <view class="modal-body">
        <view class="member-management">
          <view class="management-section">
            <text class="section-title">æˆå‘˜åˆ—è¡¨</text>
            <view class="member-search">
              <input class="search-input" placeholder="æœç´¢æˆå‘˜" bindinput="onMemberSearch" value="{{memberSearchKeyword}}" />
            </view>
          </view>
          
          <view class="filtered-members">
            <view class="member-row" wx:for="{{filteredMembers}}" wx:key="userId">
              <view class="member-info">
                <text class="member-name">{{item.nickName}}</text>
                <text class="member-role">{{getRoleText(item.role)}}</text>
              </view>
              <view class="member-actions">
                <button class="action-btn small" bindtap="changeRole" data-member="{{item}}" wx:if="{{item.role !== 'creator'}}">
                  æ›´æ”¹è§’è‰²
                </button>
                <button class="action-btn small danger" bindtap="removeMember" data-member="{{item}}" wx:if="{{item.role !== 'creator'}}">
                  ç§»é™¤
                </button>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="hideMemberModal">å…³é—­</button>
      </view>
    </view>
  </view>
</view>
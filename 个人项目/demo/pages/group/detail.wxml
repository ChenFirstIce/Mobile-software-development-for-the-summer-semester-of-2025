<!--pages/group/detail.wxml-->
<view class="container">
  <!-- 群组头部 -->
  <view class="group-header">
    <view class="header-background">
      <image wx:if="{{group.coverImage}}" src="{{group.coverImage}}" mode="aspectFill" class="header-bg"></image>
      <view wx:else class="header-bg-placeholder"></view>
      <view class="header-overlay"></view>
    </view>
    
    <view class="header-content">
      <view class="group-avatar">
        <image wx:if="{{group.coverImage}}" src="{{group.coverImage}}" mode="aspectFill" class="avatar-img"></image>
        <view wx:else class="avatar-placeholder">
          <text class="avatar-text">{{group.name.charAt(0)}}</text>
        </view>
      </view>
      
      <view class="group-info">
        <text class="group-name">{{group.name}}</text>
        <text class="group-desc" style="color: black">{{group.description || '暂无描述'}}</text>
        
        <view class="group-meta">
          <view class="meta-item">
            <text class="meta-icon">👥</text>
            <text class="meta-text" style="color: black">{{group.memberCount}}/{{group.maxMembers}}人</text>
          </view>
        </view>
        
        <view class="group-tags" wx:if="{{group.tags && group.tags.length > 0}}">
          <view class="tag-item" wx:for="{{group.tags}}" wx:key="index">
            {{item}}
          </view>
        </view>
      </view>
      
      <view class="header-actions">
        <button class="action-btn primary" bindtap="joinGroup" wx:if="{{!isMember}}">
          <text class="btn-icon">➕</text>
          <text class="btn-text">加入群组</text>
        </button>
        <button class="action-btn" bindtap="editGroup" wx:if="{{isCreator}}">
          <text class="btn-icon">✏️</text>
          <text class="btn-text">编辑</text>
        </button>
        <button class="action-btn" bindtap="shareGroup" wx:if="{{isMember}}">
          <text class="btn-icon">📤</text>
          <text class="btn-text">分享</text>
        </button>
      </view>
    </view>
  </view>

  <!-- 群组功能 -->
  <view class="group-features" wx:if="{{isMember}}">
    <view class="features-title">群组功能</view>
    
    <view class="features-grid">
      <view class="feature-card" bindtap="openRandomWheel" wx:if="{{group.features.random}}">
        <image class="feature-icon" src="/images/wheel-of-fortune.png"></image>
        <text class="feature-name">随机转盘</text>
        <text class="feature-desc">随机选择目的地</text>
      </view>
      
      <view class="feature-card" bindtap="openPriceVote" wx:if="{{group.features.priceVote}}">
        <image class="feature-icon" src="/images/money-bag.png"></image>
        <text class="feature-name">价格投票</text>
        <text class="feature-desc">预测最低价</text>
      </view>
      
      <view class="feature-card" bindtap="openSharedAlbum" wx:if="{{group.features.sharedAlbum}}">
        <view class="feature-icon">📸</view>
        <text class="feature-name">共同相册</text>
        <text class="feature-desc">{{hasSharedAlbum ? '查看相册' : '创建相册'}}</text>
      </view>
      
      <view class="feature-card" bindtap="openMapCheckin" wx:if="{{group.features.mapCheckin}}">
        <view class="feature-icon">🗺️</view>
        <text class="feature-name">地图打卡</text>
        <text class="feature-desc">位置分享</text>
      </view>
    </view>
  </view>

  <!-- 成员列表 -->
  <view class="members-section">
    <view class="section-header">
      <text class="section-title">群组成员</text>
      <text class="member-count">{{group.memberCount}}人</text>
    </view>
    
    <view class="members-list">
      <view class="member-item" wx:for="{{group.members}}" wx:key="userId">
        <view class="member-avatar">
          <image wx:if="{{item.avatarUrl}}" src="{{item.avatarUrl}}" mode="aspectFill" class="member-img"></image>
          <view wx:else class="member-placeholder">
            <text class="member-text">{{item.nickName.charAt(0)}}</text>
          </view>
        </view>
        
        <view class="member-info">
          <view class="member-header">
            <text class="member-name">{{item.nickName}}</text>
            <view class="member-role">
              <text class="role-badge {{item.role}}">{{getRoleText(item.role)}}</text>
            </view>
          </view>
          <text class="member-join-time">加入时间：{{item.joinTime}}</text>
        </view>
        
        <view class="member-actions" wx:if="{{isCreator && item.role !== 'creator'}}">
          <button class="member-btn" bindtap="removeMember" data-member="{{item}}">
            <text class="btn-icon">❌</text>
          </button>
        </view>
      </view>
    </view>
  </view>


  <!-- 群组设置 -->
  <view class="group-settings" wx:if="{{isCreator}}">
    <view class="section-header">
      <text class="section-title">群组设置</text>
    </view>
    
    <view class="settings-list">
      <view class="setting-item" bindtap="editGroupInfo">
        <view class="setting-icon">📝</view>
        <text class="setting-name">编辑群组信息</text>
        <text class="setting-arrow">></text>
      </view>
      
      <view class="setting-item" bindtap="manageMembers">
        <view class="setting-icon">👥</view>
        <text class="setting-name">成员管理</text>
        <text class="setting-arrow">></text>
      </view>
      
      <view class="setting-item" bindtap="deleteGroup">
        <view class="setting-icon">🗑️</view>
        <text class="setting-name">解散群组</text>
        <text class="setting-arrow">></text>
      </view>
    </view>
  </view>

  <!-- 退出群组 -->
  <view class="leave-section" wx:if="{{isMember && !isCreator}}">
    <button class="leave-btn" bindtap="leaveGroup">
      <text class="btn-icon">🚪</text>
      <text class="btn-text">退出群组</text>
    </button>
  </view>

  <!-- 加入群组弹窗 -->
  <view class="modal-overlay" wx:if="{{showJoinModal}}" bindtap="hideJoinModal">
    <view class="modal-content join-modal" >
      <view class="modal-header">
        <text class="modal-title">加入群组</text>
        <view class="close-btn" bindtap="hideJoinModal">✕</view>
      </view>
    
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="hideJoinModal">取消</button>
        <button class="btn-primary" bindtap="confirmJoin" disabled="{{!canJoin}}">
          确认加入
        </button>
      </view>
    </view>
  </view>

  <!-- 成员管理弹窗 -->
  <view class="modal-overlay" wx:if="{{showMemberModal}}" bindtap="hideMemberModal">
    <view class="modal-content member-modal" >
      <view class="modal-header">
        <text class="modal-title">成员管理</text>
        <view class="close-btn" bindtap="hideMemberModal">✕</view>
      </view>
      
      <view class="modal-body">
        <view class="member-management">
          <view class="management-section">
            <text class="section-title">成员列表</text>
            <view class="member-search">
              <input class="search-input" placeholder="搜索成员" bindinput="onMemberSearch" value="{{memberSearchKeyword}}" />
            </view>
          </view>
          
          <view class="filtered-members">
            <view class="member-row" wx:for="{{filteredMembers}}" wx:key="userId">
              <view class="member-info">
                <text class="member-name">{{item.nickName}}</text>
                <text class="member-role">{{getRoleText(item.role)}}</text>
              </view>
              <view class="member-actions">
                <button class="action-btn small" bindtap="changeRole" data-member="{{item}}" wx:if="{{item.role !== 'creator'}}">
                  更改角色
                </button>
                <button class="action-btn small danger" bindtap="removeMember" data-member="{{item}}" wx:if="{{item.role !== 'creator'}}">
                  移除
                </button>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="hideMemberModal">关闭</button>
      </view>
    </view>
  </view>
</view>
<!--pages/group/create.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">创建旅游群</text>
    <text class="page-subtitle">与朋友一起规划完美旅程</text>
  </view>

  <!-- 创建表单 -->
  <view class="create-form">
    <!-- 基本信息 -->
    <view class="form-section">
      <view class="section-title">
        <text class="title-text">基本信息</text>
      </view>
      
      <view class="input-group">
        <text class="input-label">群组名称 *</text>
        <input class="input-field" placeholder="请输入群组名称" bindinput="onNameInput" value="{{groupName}}" maxlength="20" />
        <text class="char-count">{{groupName.length}}/20</text>
      </view>
      
      <view class="input-group">
        <text class="input-label">群组描述</text>
        <textarea class="textarea-field" placeholder="描述一下这个旅游群的目的或特色" bindinput="onDescInput" value="{{groupDesc}}" maxlength="100" />
        <text class="char-count">{{groupDesc.length}}/100</text>
      </view>
      
      <view class="input-group">
        <text class="input-label">群组类型</text>
        <view class="type-selector">
          <view class="type-option {{groupType === 'public' ? 'active' : ''}}" bindtap="selectType" data-type="public">
            <text class="type-text">公开群组</text>
            <text class="type-desc">任何人都可以搜索加入</text>
          </view>
          <view class="type-option {{groupType === 'private' ? 'active' : ''}}" bindtap="selectType" data-type="private">
            <text class="type-text">私密群组</text>
            <text class="type-desc">仅邀请码或二维码加入</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 群组设置 -->
    <view class="form-section">
      <view class="section-title">
        <text class="title-icon">⚙️</text>
        <text class="title-text">群组设置</text>
      </view>
      
      <view class="input-group">
        <text class="input-label">最大成员数</text>
        <view class="member-selector">
          <view class="member-option {{maxMembers === 5 ? 'active' : ''}}" bindtap="selectMaxMembers" data-count="5">
            <text class="member-count">5人</text>
            <text class="member-desc">小团队</text>
          </view>
          <view class="member-option {{maxMembers === 10 ? 'active' : ''}}" bindtap="selectMaxMembers" data-count="10">
            <text class="member-count">10人</text>
            <text class="member-desc">标准团队</text>
          </view>
          <view class="member-option {{maxMembers === 20 ? 'active' : ''}}" bindtap="selectMaxMembers" data-count="20">
            <text class="member-count">20人</text>
            <text class="member-desc">大团队</text>
          </view>
        </view>
      </view>
      
      <view class="input-group">
        <text class="input-label">加入验证</text>
        <view class="verification-options">
          <view class="verification-option {{verificationType === 'none' ? 'active' : ''}}" bindtap="selectVerification" data-type="none">
            <text class="option-icon">✅</text>
            <text class="option-text">无需验证</text>
          </view>
          <view class="verification-option {{verificationType === 'code' ? 'active' : ''}}" bindtap="selectVerification" data-type="code">
            <text class="option-icon">🔑</text>
            <text class="option-text">邀请码</text>
          </view>
          <view class="verification-option {{verificationType === 'approval' ? 'active' : ''}}" bindtap="selectVerification" data-type="approval">
            <text class="option-icon">👁️</text>
            <text class="option-text">需要审批</text>
          </view>
        </view>
      </view>
      
      <view class="input-group" wx:if="{{verificationType === 'code'}}">
        <text class="input-label">邀请码</text>
        <view class="invite-code-section">
          <input class="code-input" placeholder="请输入4-8位邀请码" bindinput="onInviteCodeInput" value="{{inviteCode}}" maxlength="8" />
          <button class="generate-btn" bindtap="generateInviteCode">生成</button>
        </view>
      </view>
    </view>

    <!-- 功能设置 -->
    <view class="form-section">
      <view class="section-title">
        <text class="title-icon">🎯</text>
        <text class="title-text">功能设置</text>
      </view>
      
      <view class="feature-list">
        <view class="feature-item">
          <view class="feature-info">
            <text class="feature-icon">🎲</text>
            <view class="feature-details">
              <text class="feature-name">随机功能</text>
              <text class="feature-desc">创建转盘，随机选择目的地或活动</text>
            </view>
          </view>
          <switch class="feature-switch" checked="{{features.random}}" bindchange="toggleFeature" data-feature="random" />
        </view>
        
        <view class="feature-item">
          <view class="feature-info">
            <text class="feature-icon">💰</text>
            <view class="feature-details">
              <text class="feature-name">价格投票</text>
              <text class="feature-desc">匿名投票，预测最低价和最高价</text>
            </view>
          </view>
          <switch class="feature-switch" checked="{{features.priceVote}}" bindchange="toggleFeature" data-feature="priceVote" />
        </view>
        
        <view class="feature-item">
          <view class="feature-info">
            <text class="feature-icon">📸</text>
            <view class="feature-details">
              <text class="feature-name">共同相册</text>
              <text class="feature-desc">群成员可以共享照片到群相册</text>
            </view>
          </view>
          <switch class="feature-switch" checked="{{features.sharedAlbum}}" bindchange="toggleFeature" data-feature="sharedAlbum" />
        </view>
        
        <view class="feature-item">
          <view class="feature-info">
            <text class="feature-icon">🗺️</text>
            <view class="feature-details">
              <text class="feature-name">地图打卡</text>
              <text class="feature-desc">群成员可以在地图上打卡分享位置</text>
            </view>
          </view>
          <switch class="feature-switch" checked="{{features.mapCheckin}}" bindchange="toggleFeature" data-feature="mapCheckin" />
        </view>
      </view>
    </view>

    <!-- 群组封面 -->
    <view class="form-section">
      <view class="section-title">
        <text class="title-icon">🖼️</text>
        <text class="title-text">群组封面</text>
      </view>
      
      <view class="cover-section">
        <view class="cover-preview" bindtap="selectCover">
          <image wx:if="{{coverImage}}" src="{{coverImage}}" mode="aspectFill" class="cover-img"></image>
          <view wx:else class="cover-placeholder">
            <text class="placeholder-icon">📷</text>
            <text class="placeholder-text">点击选择封面</text>
          </view>
        </view>
        
        <view class="cover-actions">
          <button class="cover-btn" bindtap="selectCover">
            <text class="btn-icon">📷</text>
            <text class="btn-text">选择图片</text>
          </button>
          <button class="cover-btn" bindtap="takePhoto" wx:if="{{coverImage}}">
            <text class="btn-icon">📱</text>
            <text class="btn-text">拍照</text>
          </button>
          <button class="cover-btn danger" bindtap="removeCover" wx:if="{{coverImage}}">
            <text class="btn-icon">🗑️</text>
            <text class="btn-text">删除</text>
          </button>
        </view>
      </view>
    </view>

    <!-- 标签设置 -->
    <view class="form-section">
      <view class="section-title">
        <text class="title-icon">🏷️</text>
        <text class="title-text">标签设置</text>
      </view>
      
      <view class="tags-section">
        <view class="tags-display">
          <view class="tag-item" wx:for="{{selectedTags}}" wx:key="index">
            <text class="tag-text">{{item}}</text>
            <text class="tag-remove" bindtap="removeTag" data-index="{{index}}">✕</text>
          </view>
          <view class="add-tag-btn" bindtap="showTagSelector" wx:if="{{selectedTags.length < 5}}">
            <text class="add-icon">+</text>
            <text class="add-text">添加标签</text>
          </view>
        </view>
        
        <text class="tags-tip">最多可添加5个标签，帮助其他用户了解群组特色</text>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-buttons">
    <button class="btn-secondary" bindtap="cancelCreate">取消</button>
    <button class="btn-primary" bindtap="createGroup" disabled="{{!canCreate}}">
      <text class="btn-icon">✨</text>
      <text class="btn-text">创建群组</text>
    </button>
  </view>

  <!-- 标签选择弹窗 -->
  <view class="modal-overlay" wx:if="{{showTagModal}}" bindtap="hideTagSelector">
    <view class="modal-content tag-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">选择标签</text>
        <view class="close-btn" bindtap="hideTagSelector">✕</view>
      </view>
      
      <view class="modal-body">
        <view class="tag-categories">
          <view class="category-section">
            <text class="category-title">热门标签</text>
            <view class="tag-grid">
              <view class="tag-option {{selectedTags.includes(tag) ? 'selected' : ''}}" 
                    wx:for="{{popularTags}}" wx:key="index" wx:for-item="tag"
                    bindtap="toggleTag" data-tag="{{tag}}">
                {{tag}}
              </view>
            </view>
          </view>
          
          <view class="category-section">
            <text class="category-title">自定义标签</text>
            <view class="custom-tag-input">
              <input class="custom-input" placeholder="输入自定义标签" bindinput="onCustomTagInput" value="{{customTag}}" maxlength="10" />
              <button class="add-custom-btn" bindtap="addCustomTag" disabled="{{!customTag.trim()}}">添加</button>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="hideTagSelector">取消</button>
        <button class="btn-primary" bindtap="confirmTags">确定</button>
      </view>
    </view>
  </view>
</view>
<!--pages/tools/price.wxml-->
<view class="container">
  <!-- å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-left" bindtap="goBack">
      <text class="nav-arrow">â†</text>
    </view>
    <view class="nav-title">å¿ƒé€‰ä»·æ ¼</view>
    <view class="nav-right">
      <!-- å†å²åŠŸèƒ½å·²ç§»é™¤ -->
    </view>
  </view>

  <!-- ç¾¤ç»„ä¿¡æ¯ -->
  <view class="group-info" wx:if="{{groupInfo}}">
    <text class="group-name">{{groupInfo.name}}</text>
    <text class="group-desc">{{groupInfo.description || 'æš‚æ— æè¿°'}}</text>
  </view>

  <!-- åŒ¿åæ¨¡å¼åˆ‡æ¢ -->
  <view class="anonymous-section">
    <view class="switch-container">
      <text class="switch-label">åŒ¿åæ¨¡å¼</text>
      <switch class="switch" checked="{{isAnonymous}}" bindchange="toggleAnonymous" color="#667eea"></switch>
    </view>
    <text class="switch-desc">{{isAnonymous ? 'ç”¨æˆ·æ˜µç§°å°†è¢«éšè—' : 'æ˜¾ç¤ºç”¨æˆ·æ˜µç§°'}}</text>
  </view>

  <!-- æœªå®Œæˆæˆå‘˜å¤´åƒ -->
  <view class="members-section">
    <view class="section-header">
      <text class="section-title">æœªå®Œæˆè¾“å…¥</text>
      <text class="member-count">{{priceItems.length}}/{{members.length}}</text>
    </view>
    
    <view class="members-row">
      <view class="member-avatar" wx:for="{{members}}" wx:key="id" wx:if="{{!isMemberCompleted[item.id]}}">
        <image class="avatar-img" src="{{item.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
        <view class="avatar-status incomplete"></view>
      </view>
      
      <!-- çœç•¥å·æŒ‰é’® -->
      <view class="more-btn" wx:if="{{members.length > 5}}" bindtap="showIncompleteMembers">
        <text class="more-text">...</text>
      </view>
    </view>
  </view>

  <!-- æŠ˜çº¿å›¾åŒºåŸŸ -->
  <view class="chart-section">
    <view class="chart-container">
      <view class="chart-title">ä»·æ ¼åˆ†å¸ƒå›¾</view>
      
      <!-- å›¾è¡¨åŒºåŸŸ -->
      <view class="chart-area" wx:if="{{priceItems.length > 0}}">
        <view class="chart-y-axis">
          <text class="y-label">ä»·æ ¼</text>
        </view>
        
                 <view class="chart-content">
           <view class="chart-line min-line" wx:for="{{chartMinPrices}}" wx:key="index">
             <view class="line-point" style="height: {{item / maxMinPrice * 200}}rpx;"></view>
             <text class="point-value">{{item}}</text>
           </view>
           
           <view class="chart-line max-line" wx:for="{{chartMaxPrices}}" wx:key="index">
             <view class="line-point" style="height: {{item / maxMaxPrice * 200}}rpx;"></view>
             <text class="point-value">{{item}}</text>
           </view>
         </view>
        
        <view class="chart-x-axis">
          <text class="x-label" wx:for="{{chartLabels}}" wx:key="index">{{item}}</text>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="chart-empty" wx:if="{{priceItems.length === 0}}">
        <text class="empty-text">æš‚æ— ä»·æ ¼æ•°æ®</text>
        <text class="empty-desc">è¯·å…ˆè¾“å…¥ä»·æ ¼ä¿¡æ¯</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn btn-input" bindtap="showInputModal">
      <text class="btn-text">è¾“å…¥ä»·æ ¼</text>
    </button>
    
    <button class="btn btn-result" bindtap="showResults" disabled="{{priceItems.length === 0}}">
      <text class="btn-text">æŸ¥çœ‹ç»“æœ</text>
    </button>
  </view>

  <!-- é‡ç½®æŒ‰é’® -->
  <view class="reset-section">
    <button class="btn btn-reset" bindtap="resetPriceVote">
      <text class="btn-text">é‡ç½®æŠ•ç¥¨</text>
    </button>
  </view>

  <!-- è¾“å…¥å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showInputModal}}" bindtap="hideInputModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">è¾“å…¥ä»·æ ¼</text>
        <text class="modal-close" bindtap="hideInputModal">Ã—</text>
      </view>
      
      <view class="modal-body">
        <view class="price-input-group">
          <view class="input-item">
            <text class="input-label">æœ€ä½ä»·</text>
            <input class="price-input" 
                   type="number" 
                   placeholder="è¯·è¾“å…¥æœ€ä½ä»·"
                   value="{{inputMinPrice}}"
                   bindinput="onMinPriceInput"></input>
          </view>
          
          <view class="input-item">
            <text class="input-label">æœ€é«˜ä»·</text>
            <input class="price-input" 
                   type="number" 
                   placeholder="è¯·è¾“å…¥æœ€é«˜ä»·"
                   value="{{inputMaxPrice}}"
                   bindinput="onMaxPriceInput"></input>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-cancel" bindtap="hideInputModal">å–æ¶ˆ</button>
        <button class="btn btn-confirm" bindtap="confirmInput">ç¡®è®¤</button>
      </view>
    </view>
  </view>

  <!-- ç»“æœå¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showResultModal}}" bindtap="hideResultModal">
    <view class="modal-content result-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ğŸ’° ä»·æ ¼ç»Ÿè®¡</text>
      </view>
      
      <view class="modal-body">
        <view class="result-content">
          <view class="stats-section">
            <text class="stats-title">æœ€ä½ä»·ç»Ÿè®¡</text>
            <view class="stats-item">
              <text class="stats-label">æœ€é«˜ï¼š</text>
              <text class="stats-value">{{minStats.highest}}</text>
            </view>
            <view class="stats-item">
              <text class="stats-label">æœ€ä½ï¼š</text>
              <text class="stats-value">{{minStats.lowest}}</text>
            </view>
            <view class="stats-item">
              <text class="stats-label">å¹³å‡ï¼š</text>
              <text class="stats-value">{{minStats.average}}</text>
            </view>
          </view>
          
          <view class="stats-section">
            <text class="stats-title">æœ€é«˜ä»·ç»Ÿè®¡</text>
            <view class="stats-item">
              <text class="stats-label">æœ€é«˜ï¼š</text>
              <text class="stats-value">{{maxStats.highest}}</text>
            </view>
            <view class="stats-item">
              <text class="stats-label">æœ€ä½ï¼š</text>
              <text class="stats-value">{{maxStats.lowest}}</text>
            </view>
            <view class="stats-item">
              <text class="stats-label">å¹³å‡ï¼š</text>
              <text class="stats-value">{{maxStats.average}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-confirm" bindtap="hideResultModal">çŸ¥é“äº†</button>
      </view>
    </view>
  </view>

  <!-- æˆå‘˜åˆ—è¡¨å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showMembersModal}}" bindtap="hideMembersModal">
    <view class="modal-content members-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">æœªå®Œæˆæˆå‘˜</text>
        <text class="modal-close" bindtap="hideMembersModal">Ã—</text>
      </view>
      
      <view class="modal-body">
        <view class="members-list">
          <view class="member-item" wx:for="{{incompleteMembers}}" wx:key="id">
            <image class="member-avatar-large" src="{{item.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
            <text class="member-name">{{item.nickName}}</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-confirm" bindtap="hideMembersModal">çŸ¥é“äº†</button>
      </view>
    </view>
  </view>
</view>

<!--pages/tools/wheel.wxml-->
<view class="container">
  <!-- 导航栏 -->
  <view class="nav-bar">
    <view class="nav-title">随机转盘</view>
  </view>

  <!-- 群组信息 -->
  <view class="group-info" wx:if="{{groupInfo}}">
    <text class="group-name">{{groupInfo.name}}</text>
    <text class="group-desc">{{groupInfo.description || '暂无描述'}}</text>
  </view>

  <!-- 未完成成员头像 -->
  <view class="members-section">
    <view class="section-header">
      <text class="section-title">未完成输入</text>
      <text class="member-count">{{wheelItems.length}}/{{members.length}}</text>
    </view>
    
    <view class="members-row">
      <view class="member-avatar" wx:for="{{members}}" wx:key="id" wx:if="{{!isMemberCompleted[item.id]}}">
        <image class="avatar-img" src="{{item.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
        <view class="avatar-status incomplete"></view>
      </view>
      
      <!-- 省略号按钮 -->
      <view class="more-btn" wx:if="{{members.length > 5}}" bindtap="showIncompleteMembers">
        <text class="more-text">...</text>
      </view>
    </view>
  </view>

  <!-- 转盘区域 -->
  <view class="wheel-section">
    <view class="wheel-container">
      <!-- 使用lucky-canvas转盘组件 -->
      <lucky-wheel
        id="myLucky"
        width="500rpx"
        height="500rpx"
        blocks="{{blocks}}"
        prizes="{{prizes}}"
        buttons="{{buttons}}"
        bindstart="startSpin"
        bindend="onSpinEnd"
        wx:if="{{prizes.length > 0}}"
      />
      
      <!-- 空状态显示 -->
      <view class="empty-wheel" wx:if="{{prizes.length === 0}}">
        <text class="empty-text">暂无内容，请先输入</text>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-buttons">
    <button class="btn btn-input" bindtap="showInputModal">
      <text class="btn-text">输入内容</text>
    </button>
    
    <button class="btn btn-start {{isSpinning ? 'spinning' : ''}}" bindtap="startSpin" disabled="{{isSpinning || wheelItems.length === 0}}">
      <text class="btn-text">{{isSpinning ? '转动中...' : '开始'}}</text>
    </button>
  </view>

  <!-- 重置按钮 -->
  <view class="reset-section">
    <button class="btn btn-reset" bindtap="resetWheel">
      <text class="btn-text">重置转盘</text>
    </button>
  </view>

  <!-- 输入弹窗 -->
  <view class="modal-overlay" wx:if="{{showInputModal}}" bindtap="hideInputModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">输入内容</text>
        <text class="modal-close" bindtap="hideInputModal">×</text>
      </view>
      
      <view class="modal-body">
        <textarea class="input-textarea" 
                  placeholder="请输入您想要的内容..."
                  value="{{inputContent}}"
                  bindinput="onInputChange"
                  maxlength="50"></textarea>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-cancel" bindtap="hideInputModal">取消</button>
        <button class="btn btn-confirm" bindtap="confirmInput">确认</button>
      </view>
    </view>
  </view>

  <!-- 结果弹窗 -->
  <view class="modal-overlay" wx:if="{{showResultModal}}" bindtap="hideResultModal">
    <view class="modal-content result-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">转盘结果</text>
      </view>
      
      <view class="modal-body">
        <view class="result-content">
          <text class="result-text">{{selectedItem.content}}</text>
          <text class="result-user">—— {{selectedItem.userName}}</text>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-confirm" bindtap="hideResultModal">太棒了！</button>
      </view>
    </view>
  </view>

  <!-- 成员列表弹窗 -->
  <view class="modal-overlay" wx:if="{{showMembersModal}}" bindtap="hideMembersModal">
    <view class="modal-content members-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">未完成成员</text>
        <text class="modal-close" bindtap="hideMembersModal">×</text>
      </view>
      
      <view class="modal-body">
        <view class="members-list">
          <view class="member-item" wx:for="{{incompleteMembers}}" wx:key="id">
            <image class="member-avatar-large" src="{{item.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
            <text class="member-name">{{item.nickName}}</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-confirm" bindtap="hideMembersModal">知道了</button>
      </view>
    </view>
  </view>
</view>

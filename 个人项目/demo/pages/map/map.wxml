<!--pages/map/map.wxml-->
<view class="container">
  <!-- 地图类型切换 -->
  <view class="map-type-switcher">
    <view class="type-btn {{mapType === 'basic' ? 'active' : ''}}" bindtap="switchMapType" data-type="basic">
      <text class="type-text">基础地图</text>
    </view>
    <view class="type-btn {{mapType === 'special' ? 'active' : ''}}" bindtap="switchMapType" data-type="special">
      <text class="type-text">特殊地图</text>
    </view>
  </view>

  <!-- 搜索框 -->
  <view class="search-container" wx:if="{{mapType === 'basic'}}">
    <!--下拉框-->
    <view class="dropdown-container">
      <view class="dropdown" bindtap="toggleDropdown">
        <text class="dropdown-text">{{selectedCategory || '选择类型'}}</text>
        <text class="dropdown-arrow {{dropdownOpen ? 'open' : ''}}">▼</text>
      </view>
      <view class="dropdown-menu {{dropdownOpen ? 'show' : ''}}" wx:if="{{dropdownOpen}}">
        <view class="dropdown-item" bindtap="selectCategory" data-category="选择类型">
          <text class="item-text">选择类型</text>
        </view>
        <view class="dropdown-item" bindtap="selectCategory" data-category="美食">
          <text class="item-text">美食</text>
        </view>
        <view class="dropdown-item" bindtap="selectCategory" data-category="酒店">
          <text class="item-text">酒店</text>
        </view>
      </view>
    </view>
    <view class="search-box" style="width: 439rpx; display: flex; box-sizing: border-box">
      <input 
        class="search-input" 
        placeholder="搜索地点..." 
        bindinput="onSearchInput" 
        value="{{searchKeyword}}"
        bindconfirm="searchLocation"
        confirm-type="search"
        bindfocus="onSearchFocus"
        bindblur="onSearchBlur"
      />
      <view class="search-icon" bindtap="searchLocation">
        <image src="/images/search.png" mode="aspectFit" class="search-icon-img"></image>
      </view>
    </view>
    
    <!-- 搜索建议列表 -->
    <view class="suggestions-container" wx:if="{{showSuggestions && suggestions.length > 0}}">
      <view class="suggestions-list">
        <view 
          class="suggestion-item" 
          wx:for="{{suggestions}}" 
          wx:key="id"
          bindtap="selectSuggestion"
          data-index="{{index}}"
        >
          <view class="suggestion-content">
            <text class="suggestion-title">{{item.title}}</text>
            <text class="suggestion-address" wx:if="{{item.address}}">{{item.address}}</text>
            <text class="suggestion-category" wx:if="{{item.category}}">{{item.category}}</text>
          </view>
          <view class="suggestion-distance" wx:if="{{item._distance}}">
            <text class="distance-text">{{item._distance}}m</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 地图容器 -->
  <view class="map-container">
    <map 
      id="map"
      class="map"
      longitude="{{longitude}}"
      latitude="{{latitude}}"
      scale="{{scale}}"
      markers="{{markers}}"
      polyline="{{polyline}}"
      circles="{{circles}}"
      show-location="true"
      bindmarkertap="onMarkerTap"
      bindtap="onMapTap">
    </map>
  </view>

  <!-- 地图控制按钮 -->
  <view class="map-controls">
    <view class="control-btn" bindtap="moveToLocation">
      <text class="control-icon">📍</text>
    </view>
    <view class="control-btn" bindtap="zoomIn">
      <text class="control-icon">➕</text>
    </view>
    <view class="control-btn" bindtap="zoomOut">
      <text class="control-icon">➖</text>
    </view>
  </view>

  <!-- 功能导航区域 -->
  <view class="feature-section">
    <view class="feature-cards">
      <view class="feature-card" bindtap="navigateToRoute">
        <image class="card-icon" src="/images/map-3.png" mode="aspectFit"></image>
        <view class="card-content">
          <text class="card-title">路径规划</text>
          <text class="card-desc">智能路线规划，多种交通方式</text>
        </view>
        <view class="card-arrow">></view>
      </view>

      <view class="feature-card" bindtap="showCheckinModal">
        <text class="card-icon">📍</text>
        <view class="card-content">
          <text class="card-title">地图打卡</text>
          <text class="card-desc">记录位置，分享足迹</text>
        </view>
        <view class="card-arrow">></view>
      </view>

      <view class="feature-card" bindtap="navigateToStats">
        <image class="card-icon" src="/images/graph.png" mode="aspectFit"></image>
        <view class="card-content">
          <text class="card-title">数据统计</text>
          <text class="card-desc">查看活动数据，分析趋势</text>
        </view>
        <view class="card-arrow">></view>
      </view>
    </view>
  </view>
</view>
<!--pages/map/map.wxml-->
<view class="container">
  <!-- åœ°å›¾ç±»å‹åˆ‡æ¢ -->
  <view class="map-type-switcher">
    <view class="type-btn {{mapType === 'basic' ? 'active' : ''}}" bindtap="switchMapType" data-type="basic">
      <text class="type-text">åŸºç¡€åœ°å›¾</text>
    </view>
    <view class="type-btn {{mapType === 'special' ? 'active' : ''}}" bindtap="switchMapType" data-type="special">
      <text class="type-text">ç‰¹æ®Šåœ°å›¾</text>
    </view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-container" wx:if="{{mapType === 'basic'}}">
    <!--ä¸‹æ‹‰æ¡†-->
    <view class="dropdown-container">
      <view class="dropdown" bindtap="toggleDropdown">
        <text class="dropdown-text">{{selectedCategory || 'é€‰æ‹©ç±»å‹'}}</text>
        <text class="dropdown-arrow {{dropdownOpen ? 'open' : ''}}">â–¼</text>
      </view>
      <view class="dropdown-menu {{dropdownOpen ? 'show' : ''}}" wx:if="{{dropdownOpen}}">
        <view class="dropdown-item" bindtap="selectCategory" data-category="é€‰æ‹©ç±»å‹">
          <text class="item-text">é€‰æ‹©ç±»å‹</text>
        </view>
        <view class="dropdown-item" bindtap="selectCategory" data-category="ç¾é£Ÿ">
          <text class="item-text">ç¾é£Ÿ</text>
        </view>
        <view class="dropdown-item" bindtap="selectCategory" data-category="é…’åº—">
          <text class="item-text">é…’åº—</text>
        </view>
      </view>
    </view>
    <view class="search-box" style="width: 439rpx; display: flex; box-sizing: border-box">
      <input 
        class="search-input" 
        placeholder="æœç´¢åœ°ç‚¹..." 
        bindinput="onSearchInput" 
        value="{{searchKeyword}}"
        bindconfirm="searchLocation"
        confirm-type="search"
        bindfocus="onSearchFocus"
        bindblur="onSearchBlur"
      />
      <view class="search-icon" bindtap="searchLocation">ğŸ”</view>
    </view>
    
    <!-- æœç´¢å»ºè®®åˆ—è¡¨ -->
    <view class="suggestions-container" wx:if="{{showSuggestions && suggestions.length > 0}}">
      <view class="suggestions-list">
        <view 
          class="suggestion-item" 
          wx:for="{{suggestions}}" 
          wx:key="id"
          bindtap="selectSuggestion"
          data-index="{{index}}"
        >
          <view class="suggestion-content">
            <text class="suggestion-title">{{item.title}}</text>
            <text class="suggestion-address" wx:if="{{item.address}}">{{item.address}}</text>
            <text class="suggestion-category" wx:if="{{item.category}}">{{item.category}}</text>
          </view>
          <view class="suggestion-distance" wx:if="{{item._distance}}">
            <text class="distance-text">{{item._distance}}m</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åœ°å›¾å®¹å™¨ -->
  <view class="map-container">
    <map 
      id="map"
      class="map"
      longitude="{{longitude}}"
      latitude="{{latitude}}"
      scale="{{scale}}"
      markers="{{markers}}"
      polyline="{{polyline}}"
      show-location="true"
      bindmarkertap="onMarkerTap"
      bindregionchange="onRegionChange"
      bindtap="onMapTap">
    </map>
  </view>

  <!-- åœ°å›¾æ§åˆ¶æŒ‰é’® -->
  <view class="map-controls">
    <view class="control-btn" bindtap="moveToLocation">
      <text class="control-icon">ğŸ“</text>
    </view>
    <view class="control-btn" bindtap="zoomIn">
      <text class="control-icon">â•</text>
    </view>
    <view class="control-btn" bindtap="zoomOut">
      <text class="control-icon">â–</text>
    </view>
  </view>

  <!-- åŠŸèƒ½æŒ‰é’®åŒºåŸŸ -->
  <view class="function-buttons">
    <button class="func-btn checkin-btn" bindtap="showCheckinModal">
      <text class="btn-icon">ğŸ“</text>
      <text class="btn-text">æ‰“å¡</text>
    </button>
    
    
    <button class="func-btn stats-btn" bindtap="navigateToStats">
      <text class="btn-icon">ğŸ“Š</text>
      <text class="btn-text">ç»Ÿè®¡</text>
    </button>
  </view>
</view>
<!--pages/album/detail.wxml-->
<view class="container">
  <!-- ç›¸å†Œå¤´éƒ¨ä¿¡æ¯ -->
  <view class="album-header">
    <view class="album-cover">
      <image wx:if="{{album.coverImage}}" src="{{album.coverImage}}" mode="aspectFill" class="cover-image"></image>
      <view wx:else class="cover-placeholder">
        <text class="placeholder-icon">ğŸ“·</text>
      </view>
      <view class="album-type-badge {{album.type === 'shared' ? 'shared' : 'personal'}}">
        {{album.type === 'shared' ? 'å…±æœ‰' : 'ä¸ªäºº'}}
      </view>
    </view>
    
    <view class="album-info">
      <text class="album-name">{{album.name}}</text>
      <text class="album-desc">{{album.description || 'æš‚æ— æè¿°'}}</text>
      
      <view class="album-meta">
        <view class="meta-item">
          <image class="meta-icon" src="/images/camera.png" mode="aspectFit"></image>
          <text class="meta-text">{{album.photoCount || 0}}å¼ ç…§ç‰‡</text>
        </view>
        <view class="meta-item">
          <image class="meta-icon" src="/images/group-1.png" mode="aspectFit"></image>
          <text class="meta-text">{{album.memberCount || 1}}äºº</text>
        </view>
        <view class="meta-item">
          <image class="meta-icon" src="/images/calendar.png" mode="aspectFit"></image>
          <text class="meta-text">{{album.createTime}}</text>
        </view>
      </view>
      
      <view class="album-tags" wx:if="{{album.tags && album.tags.length > 0}}">
        <view class="tag-item" wx:for="{{album.tags}}" wx:key="index">
          {{item}}
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-bar">
    <button class="action-btn primary" bindtap="addPhotos">
      <text class="btn-icon">ğŸ“·</text>
      <text class="btn-text">æ·»åŠ ç…§ç‰‡</text>
    </button>
    
    <button class="action-btn" bindtap="editAlbum" wx:if="{{canEdit}}">
      <image class="btn-icon" src="/images/pen.png" mode="aspectFit"></image>
      <text class="btn-text">ç¼–è¾‘ç›¸å†Œ</text>
    </button>
  </view>

  <!-- ç…§ç‰‡ç½‘æ ¼ -->
  <view class="photos-section">
    <view class="section-header">
      <text class="section-title">ç…§ç‰‡ ({{album.photoCount || 0}})</text>
      <view class="view-mode">
        <view class="mode-btn {{viewMode === 'grid' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="grid">
          <text class="mode-icon">âŠ</text>
        </view>
        <view class="mode-btn {{viewMode === 'list' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="list">
          <text class="mode-icon">â˜°</text>
        </view>
      </view>
    </view>
    
    <!-- ç½‘æ ¼è§†å›¾ -->
    <view class="photos-grid" wx:if="{{viewMode === 'grid' && photos.length > 0}}">
      <view class="photo-item" wx:for="{{photos}}" wx:key="id" bindtap="{{isBatchMode ? 'togglePhotoSelection' : 'viewPhoto'}}" data-id="{{item._id || item.id}}">
        <image src="{{item.fileId}}" mode="aspectFill" class="photo-image"></image>
        <view class="photo-overlay">
          <view class="photo-actions" wx:if="{{!isBatchMode}}">
            <image class="action-icon" catchtap="deletePhoto" data-id="{{item._id || item.id}}" src="/images/bin.png" mode="aspectFit"></image>
            <view class="action-icon" catchtap="downloadPhoto" data-id="{{item._id || item.id}}">â¬‡ï¸</view>
          </view>
          <view class="photo-selection" wx:if="{{isBatchMode}}">
            <view class="selection-checkbox {{selectedPhotos.indexOf(item._id || item.id) > -1 ? 'selected' : ''}}">
              {{selectedPhotos.indexOf(item._id || item.id) > -1 ? 'âœ“' : ''}}
            </view>
          </view>
        </view>
        <view class="photo-info">
          <text class="photo-time">{{item.uploadTime}}</text>
        </view>
      </view>
    </view>
    
    <!-- åˆ—è¡¨è§†å›¾ -->
    <view class="photos-list" wx:if="{{viewMode === 'list' && photos.length > 0}}">
      <view class="photo-list-item" wx:for="{{photos}}" wx:key="id" bindtap="{{isBatchMode ? 'togglePhotoSelection' : 'viewPhoto'}}" data-id="{{item._id || item.id}}">
        <image src="{{item.fileId}}" mode="aspectFill" class="list-photo"></image>
        <view class="list-photo-info">
          <text class="list-photo-name">{{item.name || 'æœªå‘½åç…§ç‰‡'}}</text>
          <text class="list-photo-time">{{item.updateTime}}</text>
          <text class="list-photo-desc">{{item.description || 'æš‚æ— æè¿°'}}</text>
        </view>
        <view class="list-photo-actions" wx:if="{{!isBatchMode}}">
          <image class="action-icon" catchtap="deletePhoto" data-id="{{item._id || item.id}}" src="/images/bin.png" mode="aspectFit"></image>
          <view class="action-icon" catchtap="downloadPhoto" data-id="{{item._id || item.id}}">â¬‡ï¸</view>
        </view>
        <view class="list-photo-selection" wx:if="{{isBatchMode}}">
          <view class="selection-checkbox {{selectedPhotos.indexOf(item._id || item.id) > -1 ? 'selected' : ''}}">
            {{selectedPhotos.indexOf(item._id || item.id) > -1 ? 'âœ“' : ''}}
          </view>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-photos" wx:if="{{photos.length === 0}}">
      <view class="empty-icon">ğŸ“·</view>
      <text class="empty-title">æš‚æ— ç…§ç‰‡</text>
      <text class="empty-desc">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ ç¬¬ä¸€å¼ ç…§ç‰‡</text>
    </view>
  </view>

  <!-- æ‰¹é‡æ“ä½œæ¨¡å¼ -->
  <view class="batch-mode" wx:if="{{isBatchMode}}">
    <view class="batch-header">
      <text class="batch-title">æ‰¹é‡æ“ä½œæ¨¡å¼</text>
      <button class="btn-secondary" bindtap="exitBatchMode">é€€å‡º</button>
    </view>
    
    <view class="batch-actions">
      <button class="btn-danger" bindtap="batchDelete" disabled="{{selectedPhotos.length === 0}}">
        åˆ é™¤é€‰ä¸­ ({{selectedPhotos.length}})
      </button>
      <button class="btn-secondary" bindtap="selectAll">
        {{isAllSelected ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}
      </button>
    </view>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="fab" bindtap="toggleBatchMode">
    <image wx:if="{{!isBatchMode}}" class="fab-icon" src="/images/settings.png"></image>
    <text wx:else class="fab-icon">âœ•</text>
  </view>

  <!-- ç…§ç‰‡è¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showPhotoModal}}" bindtap="hidePhotoModal">
    <view class="modal-content photo-modal" >
      <view class="modal-header">
        <text class="modal-title">ç…§ç‰‡è¯¦æƒ…</text>
        <view class="close-btn" bindtap="hidePhotoModal">âœ•</view>
      </view>
      
      <view class="modal-body">
        <image src="{{selectedPhoto.fileId}}" mode="aspectFit" class="modal-photo"></image>
        
        <view class="photo-details">
          <view class="detail-item">
            <text class="detail-label">åç§°ï¼š</text>
            <text class="detail-value">{{selectedPhoto.name || 'æœªå‘½å'}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">ä¸Šä¼ æ—¶é—´ï¼š</text>
            <text class="detail-value">{{selectedPhoto.createTime || selectedPhoto.uploadTime || 'æœªçŸ¥'}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æè¿°ï¼š</text>
            <text class="detail-value">{{selectedPhoto.description || 'æ— '}}</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="hidePhotoModal">å…³é—­</button>
      </view>
    </view>
  </view>
</view>
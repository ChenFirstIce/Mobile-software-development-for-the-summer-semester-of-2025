<!--pages/hotel/hotel.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">酒店比价</text>
    <text class="page-subtitle">多平台价格对比，找到最优惠的酒店</text>
  </view>

  <!-- 搜索区域 -->
  <view class="search-section">
    <view class="search-form">
      <view class="input-group">
        <text class="input-label">目的地</text>
        <input class="input-field" placeholder="请输入城市或酒店名称" bindinput="onDestinationInput" value="{{destination}}" />
      </view>
      
      <view class="input-row">
        <view class="input-group">
          <text class="input-label">入住日期</text>
          <picker mode="date" value="{{checkInDate}}" bindchange="onCheckInChange">
            <view class="date-picker">
              <text class="date-text">{{checkInDate || '选择日期'}}</text>
              <text class="date-icon">📅</text>
            </view>
          </picker>
        </view>
        
        <view class="input-group">
          <text class="input-label">退房日期</text>
          <picker mode="date" value="{{checkOutDate}}" bindchange="onCheckOutChange">
            <view class="date-picker">
              <text class="date-text">{{checkOutDate || '选择日期'}}</text>
              <text class="date-icon">📅</text>
            </view>
          </picker>
        </view>
      </view>
      
      <view class="input-row">
        <view class="input-group">
          <text class="input-label">房间数</text>
          <picker mode="selector" range="{{roomOptions}}" value="{{roomIndex}}" bindchange="onRoomChange">
            <view class="picker-field">
              <text class="picker-text">{{roomOptions[roomIndex]}}</text>
              <text class="picker-icon">▼</text>
            </view>
          </picker>
        </view>
        
        <view class="input-group">
          <text class="input-label">入住人数</text>
          <picker mode="selector" range="{{guestOptions}}" value="{{guestIndex}}" bindchange="onGuestChange">
            <view class="picker-field">
              <text class="picker-text">{{guestOptions[guestIndex]}}</text>
              <text class="picker-icon">▼</text>
            </view>
          </picker>
        </view>
      </view>
      
      <button class="search-btn" bindtap="searchHotels" disabled="{{!canSearch}}">
        <text class="btn-icon">🔍</text>
        <text class="btn-text">搜索酒店</text>
      </button>
    </view>
  </view>

  <!-- 筛选条件 -->
  <view class="filter-section" wx:if="{{hotels.length > 0}}">
    <view class="filter-title">筛选条件</view>
    
    <view class="filter-options">
      <view class="filter-group">
        <text class="filter-label">价格范围</text>
        <view class="price-range">
          <input class="price-input" placeholder="最低价" bindinput="onMinPriceInput" value="{{minPrice}}" type="number" />
          <text class="price-separator">-</text>
          <input class="price-input" placeholder="最高价" bindinput="onMaxPriceInput" value="{{maxPrice}}" type="number" />
        </view>
      </view>
      
      <view class="filter-group">
        <text class="filter-label">星级</text>
        <view class="star-filters">
          <view class="star-btn {{starFilter === 'all' ? 'active' : ''}}" bindtap="setStarFilter" data-star="all">
            全部
          </view>
          <view class="star-btn {{starFilter === '5' ? 'active' : ''}}" bindtap="setStarFilter" data-star="5">
            5星
          </view>
          <view class="star-btn {{starFilter === '4' ? 'active' : ''}}" bindtap="setStarFilter" data-star="4">
            4星
          </view>
          <view class="star-btn {{starFilter === '3' ? 'active' : ''}}" bindtap="setStarFilter" data-star="3">
            3星
          </view>
        </view>
      </view>
      
      <view class="filter-group">
        <text class="filter-label">排序方式</text>
        <view class="sort-options">
          <view class="sort-btn {{sortBy === 'price' ? 'active' : ''}}" bindtap="setSortBy" data-sort="price">
            价格
          </view>
          <view class="sort-btn {{sortBy === 'rating' ? 'active' : ''}}" bindtap="setSortBy" data-sort="rating">
            评分
          </view>
          <view class="sort-btn {{sortBy === 'distance' ? 'active' : ''}}" bindtap="setSortBy" data-sort="distance">
            距离
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 酒店列表 -->
  <view class="hotel-list" wx:if="{{hotels.length > 0}}">
    <view class="list-header">
      <text class="result-count">找到 {{filteredHotels.length}} 家酒店</text>
      <view class="view-mode">
        <view class="mode-btn {{viewMode === 'list' ? 'active' : ''}}" bindtap="setViewMode" data-mode="list">
          <text class="mode-icon">☰</text>
        </view>
        <view class="mode-btn {{viewMode === 'grid' ? 'active' : ''}}" bindtap="setViewMode" data-mode="grid">
          <text class="mode-icon">⊞</text>
        </view>
      </view>
    </view>
    
    <!-- 列表视图 -->
    <view class="hotels-list" wx:if="{{viewMode === 'list'}}">
      <view class="hotel-item" wx:for="{{filteredHotels}}" wx:key="id" bindtap="viewHotelDetail" data-hotel="{{item}}">
        <view class="hotel-image">
          <image src="{{item.image || '/images/default-hotel.png'}}" mode="aspectFill" class="hotel-img"></image>
          <view class="hotel-rating">
            <text class="rating-text">{{item.rating}}</text>
            <text class="rating-star">⭐</text>
          </view>
        </view>
        
        <view class="hotel-info">
          <view class="hotel-header">
            <text class="hotel-name">{{item.name}}</text>
            <view class="hotel-stars">
              <text class="star" wx:for="{{item.stars}}" wx:key="index">⭐</text>
            </view>
          </view>
          
          <text class="hotel-address">{{item.address}}</text>
          
          <view class="hotel-features">
            <view class="feature-tag" wx:for="{{item.features}}" wx:key="index" wx:for-item="feature">
              {{feature}}
            </view>
          </view>
        </view>
        
        <view class="hotel-prices">
          <view class="price-item" wx:for="{{item.prices}}" wx:key="platform" wx:for-item="price">
            <view class="platform-info">
              <image src="{{price.platformIcon}}" class="platform-icon"></image>
              <text class="platform-name">{{price.platformName}}</text>
            </view>
            <view class="price-info">
              <text class="price-value">¥{{price.price}}</text>
              <text class="price-desc">{{price.description}}</text>
            </view>
          </view>
        </view>
        
        <view class="hotel-actions">
          <button class="action-btn primary" bindtap="bookHotel" data-hotel="{{item}}" data-platform="{{item.lowestPrice.platform}}">
            立即预订
          </button>
          <button class="action-btn" bindtap="viewAllPrices" data-hotel="{{item}}">
            查看全部
          </button>
        </view>
      </view>
    </view>
    
    <!-- 网格视图 -->
    <view class="hotels-grid" wx:if="{{viewMode === 'grid'}}">
      <view class="hotel-card" wx:for="{{filteredHotels}}" wx:key="id" bindtap="viewHotelDetail" data-hotel="{{item}}">
        <view class="card-image">
          <image src="{{item.image || '/images/default-hotel.png'}}" mode="aspectFill" class="card-img"></image>
          <view class="card-rating">
            <text class="rating-text">{{item.rating}}</text>
            <text class="rating-star">⭐</text>
          </view>
        </view>
        
        <view class="card-content">
          <text class="card-name">{{item.name}}</text>
          <text class="card-address">{{item.address}}</text>
          
          <view class="card-stars">
            <text class="star" wx:for="{{item.stars}}" wx:key="index">⭐</text>
          </view>
          
          <view class="card-price">
            <text class="price-label">最低价格</text>
            <text class="price-value">¥{{item.lowestPrice.price}}</text>
            <text class="price-platform">{{item.lowestPrice.platformName}}</text>
          </view>
        </view>
        
        <view class="card-actions">
          <button class="card-btn" bindtap="bookHotel" data-hotel="{{item}}" data-platform="{{item.lowestPrice.platform}}">
            预订
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{hotels.length === 0 && hasSearched}}">
    <view class="empty-icon">🏨</view>
    <text class="empty-title">未找到相关酒店</text>
    <text class="empty-desc">请尝试调整搜索条件或更换目的地</text>
  </view>

  <!-- 加载状态 -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-icon">⏳</view>
    <text class="loading-text">正在搜索酒店...</text>
  </view>

  <!-- 价格详情弹窗 -->
  <view class="modal-overlay" wx:if="{{showPriceModal}}" bindtap="hidePriceModal">
    <view class="modal-content price-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{selectedHotel.name}} - 价格详情</text>
        <view class="close-btn" bindtap="hidePriceModal">✕</view>
      </view>
      
      <view class="modal-body">
        <view class="price-comparison">
          <view class="price-item" wx:for="{{selectedHotel.prices}}" wx:key="platform">
            <view class="platform-header">
              <image src="{{item.platformIcon}}" class="platform-icon"></image>
              <text class="platform-name">{{item.platformName}}</text>
            </view>
            
            <view class="price-details">
              <text class="price-value">¥{{item.price}}</text>
              <text class="price-desc">{{item.description}}</text>
              <text class="price-note">{{item.note || ''}}</text>
            </view>
            
            <view class="price-actions">
              <button class="book-btn" bindtap="bookHotel" data-hotel="{{selectedHotel}}" data-platform="{{item.platform}}">
                预订
              </button>
              <button class="view-btn" bindtap="viewPlatform" data-url="{{item.url}}">
                查看详情
              </button>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="hidePriceModal">关闭</button>
        <button class="btn-primary" bindtap="addToFavorites" data-hotel="{{selectedHotel}}">
          收藏酒店
        </button>
      </view>
    </view>
  </view>
</view>
<!--pages/hotel/hotel.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">é…’åº—æ¯”ä»·</text>
    <text class="page-subtitle">å¤šå¹³å°ä»·æ ¼å¯¹æ¯”ï¼Œæ‰¾åˆ°æœ€ä¼˜æƒ çš„é…’åº—</text>
  </view>

  <!-- æœç´¢åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-form">
      <view class="input-group">
        <text class="input-label">ç›®çš„åœ°</text>
        <input class="input-field" placeholder="è¯·è¾“å…¥åŸå¸‚æˆ–é…’åº—åç§°" bindinput="onDestinationInput" value="{{destination}}" />
      </view>
      
      <view class="input-row">
        <view class="input-group">
          <text class="input-label">å…¥ä½æ—¥æœŸ</text>
          <picker mode="date" value="{{checkInDate}}" bindchange="onCheckInChange">
            <view class="date-picker">
              <text class="date-text">{{checkInDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
              <text class="date-icon">ğŸ“…</text>
            </view>
          </picker>
        </view>
        
        <view class="input-group">
          <text class="input-label">é€€æˆ¿æ—¥æœŸ</text>
          <picker mode="date" value="{{checkOutDate}}" bindchange="onCheckOutChange">
            <view class="date-picker">
              <text class="date-text">{{checkOutDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
              <text class="date-icon">ğŸ“…</text>
            </view>
          </picker>
        </view>
      </view>
      
      <view class="input-row">
        <view class="input-group">
          <text class="input-label">æˆ¿é—´æ•°</text>
          <picker mode="selector" range="{{roomOptions}}" value="{{roomIndex}}" bindchange="onRoomChange">
            <view class="picker-field">
              <text class="picker-text">{{roomOptions[roomIndex]}}</text>
              <text class="picker-icon">â–¼</text>
            </view>
          </picker>
        </view>
        
        <view class="input-group">
          <text class="input-label">å…¥ä½äººæ•°</text>
          <picker mode="selector" range="{{guestOptions}}" value="{{guestIndex}}" bindchange="onGuestChange">
            <view class="picker-field">
              <text class="picker-text">{{guestOptions[guestIndex]}}</text>
              <text class="picker-icon">â–¼</text>
            </view>
          </picker>
        </view>
      </view>
      
      <button class="search-btn" bindtap="searchHotels" disabled="{{!canSearch}}">
        <text class="btn-icon">ğŸ”</text>
        <text class="btn-text">æœç´¢é…’åº—</text>
      </button>
    </view>
  </view>

  <!-- ç­›é€‰æ¡ä»¶ -->
  <view class="filter-section" wx:if="{{hotels.length > 0}}">
    <view class="filter-title">ç­›é€‰æ¡ä»¶</view>
    
    <view class="filter-options">
      <view class="filter-group">
        <text class="filter-label">ä»·æ ¼èŒƒå›´</text>
        <view class="price-range">
          <input class="price-input" placeholder="æœ€ä½ä»·" bindinput="onMinPriceInput" value="{{minPrice}}" type="number" />
          <text class="price-separator">-</text>
          <input class="price-input" placeholder="æœ€é«˜ä»·" bindinput="onMaxPriceInput" value="{{maxPrice}}" type="number" />
        </view>
      </view>
      
      <view class="filter-group">
        <text class="filter-label">æ˜Ÿçº§</text>
        <view class="star-filters">
          <view class="star-btn {{starFilter === 'all' ? 'active' : ''}}" bindtap="setStarFilter" data-star="all">
            å…¨éƒ¨
          </view>
          <view class="star-btn {{starFilter === '5' ? 'active' : ''}}" bindtap="setStarFilter" data-star="5">
            5æ˜Ÿ
          </view>
          <view class="star-btn {{starFilter === '4' ? 'active' : ''}}" bindtap="setStarFilter" data-star="4">
            4æ˜Ÿ
          </view>
          <view class="star-btn {{starFilter === '3' ? 'active' : ''}}" bindtap="setStarFilter" data-star="3">
            3æ˜Ÿ
          </view>
        </view>
      </view>
      
      <view class="filter-group">
        <text class="filter-label">æ’åºæ–¹å¼</text>
        <view class="sort-options">
          <view class="sort-btn {{sortBy === 'price' ? 'active' : ''}}" bindtap="setSortBy" data-sort="price">
            ä»·æ ¼
          </view>
          <view class="sort-btn {{sortBy === 'rating' ? 'active' : ''}}" bindtap="setSortBy" data-sort="rating">
            è¯„åˆ†
          </view>
          <view class="sort-btn {{sortBy === 'distance' ? 'active' : ''}}" bindtap="setSortBy" data-sort="distance">
            è·ç¦»
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- é…’åº—åˆ—è¡¨ -->
  <view class="hotel-list" wx:if="{{hotels.length > 0}}">
    <view class="list-header">
      <text class="result-count">æ‰¾åˆ° {{filteredHotels.length}} å®¶é…’åº—</text>
      <view class="view-mode">
        <view class="mode-btn {{viewMode === 'list' ? 'active' : ''}}" bindtap="setViewMode" data-mode="list">
          <text class="mode-icon">â˜°</text>
        </view>
        <view class="mode-btn {{viewMode === 'grid' ? 'active' : ''}}" bindtap="setViewMode" data-mode="grid">
          <text class="mode-icon">âŠ</text>
        </view>
      </view>
    </view>
    
    <!-- åˆ—è¡¨è§†å›¾ -->
    <view class="hotels-list" wx:if="{{viewMode === 'list'}}">
      <view class="hotel-item" wx:for="{{filteredHotels}}" wx:key="id" bindtap="viewHotelDetail" data-hotel="{{item}}">
        <view class="hotel-image">
          <image src="{{item.image || '/images/default-hotel.png'}}" mode="aspectFill" class="hotel-img"></image>
          <view class="hotel-rating">
            <text class="rating-text">{{item.rating}}</text>
            <text class="rating-star">â­</text>
          </view>
        </view>
        
        <view class="hotel-info">
          <view class="hotel-header">
            <text class="hotel-name">{{item.name}}</text>
            <view class="hotel-stars">
              <text class="star" wx:for="{{item.stars}}" wx:key="index">â­</text>
            </view>
          </view>
          
          <text class="hotel-address">{{item.address}}</text>
          
          <view class="hotel-features">
            <view class="feature-tag" wx:for="{{item.features}}" wx:key="index" wx:for-item="feature">
              {{feature}}
            </view>
          </view>
        </view>
        
        <view class="hotel-prices">
          <view class="price-item" wx:for="{{item.prices}}" wx:key="platform" wx:for-item="price">
            <view class="platform-info">
              <image src="{{price.platformIcon}}" class="platform-icon"></image>
              <text class="platform-name">{{price.platformName}}</text>
            </view>
            <view class="price-info">
              <text class="price-value">Â¥{{price.price}}</text>
              <text class="price-desc">{{price.description}}</text>
            </view>
          </view>
        </view>
        
        <view class="hotel-actions">
          <button class="action-btn primary" bindtap="bookHotel" data-hotel="{{item}}" data-platform="{{item.lowestPrice.platform}}">
            ç«‹å³é¢„è®¢
          </button>
          <button class="action-btn" bindtap="viewAllPrices" data-hotel="{{item}}">
            æŸ¥çœ‹å…¨éƒ¨
          </button>
        </view>
      </view>
    </view>
    
    <!-- ç½‘æ ¼è§†å›¾ -->
    <view class="hotels-grid" wx:if="{{viewMode === 'grid'}}">
      <view class="hotel-card" wx:for="{{filteredHotels}}" wx:key="id" bindtap="viewHotelDetail" data-hotel="{{item}}">
        <view class="card-image">
          <image src="{{item.image || '/images/default-hotel.png'}}" mode="aspectFill" class="card-img"></image>
          <view class="card-rating">
            <text class="rating-text">{{item.rating}}</text>
            <text class="rating-star">â­</text>
          </view>
        </view>
        
        <view class="card-content">
          <text class="card-name">{{item.name}}</text>
          <text class="card-address">{{item.address}}</text>
          
          <view class="card-stars">
            <text class="star" wx:for="{{item.stars}}" wx:key="index">â­</text>
          </view>
          
          <view class="card-price">
            <text class="price-label">æœ€ä½ä»·æ ¼</text>
            <text class="price-value">Â¥{{item.lowestPrice.price}}</text>
            <text class="price-platform">{{item.lowestPrice.platformName}}</text>
          </view>
        </view>
        
        <view class="card-actions">
          <button class="card-btn" bindtap="bookHotel" data-hotel="{{item}}" data-platform="{{item.lowestPrice.platform}}">
            é¢„è®¢
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{hotels.length === 0 && hasSearched}}">
    <view class="empty-icon">ğŸ¨</view>
    <text class="empty-title">æœªæ‰¾åˆ°ç›¸å…³é…’åº—</text>
    <text class="empty-desc">è¯·å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–æ›´æ¢ç›®çš„åœ°</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-icon">â³</view>
    <text class="loading-text">æ­£åœ¨æœç´¢é…’åº—...</text>
  </view>

  <!-- ä»·æ ¼è¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showPriceModal}}" bindtap="hidePriceModal">
    <view class="modal-content price-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{selectedHotel.name}} - ä»·æ ¼è¯¦æƒ…</text>
        <view class="close-btn" bindtap="hidePriceModal">âœ•</view>
      </view>
      
      <view class="modal-body">
        <view class="price-comparison">
          <view class="price-item" wx:for="{{selectedHotel.prices}}" wx:key="platform">
            <view class="platform-header">
              <image src="{{item.platformIcon}}" class="platform-icon"></image>
              <text class="platform-name">{{item.platformName}}</text>
            </view>
            
            <view class="price-details">
              <text class="price-value">Â¥{{item.price}}</text>
              <text class="price-desc">{{item.description}}</text>
              <text class="price-note">{{item.note || ''}}</text>
            </view>
            
            <view class="price-actions">
              <button class="book-btn" bindtap="bookHotel" data-hotel="{{selectedHotel}}" data-platform="{{item.platform}}">
                é¢„è®¢
              </button>
              <button class="view-btn" bindtap="viewPlatform" data-url="{{item.url}}">
                æŸ¥çœ‹è¯¦æƒ…
              </button>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="hidePriceModal">å…³é—­</button>
        <button class="btn-primary" bindtap="addToFavorites" data-hotel="{{selectedHotel}}">
          æ”¶è—é…’åº—
        </button>
      </view>
    </view>
  </view>
</view>
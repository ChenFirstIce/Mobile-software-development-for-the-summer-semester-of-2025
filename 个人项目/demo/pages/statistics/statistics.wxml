<!--pages/statistics/statistics.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">æ—…æ¸¸ç»Ÿè®¡</text>
    <text class="page-subtitle">æŸ¥çœ‹æ‚¨çš„æ—…è¡Œè¶³è¿¹æ•°æ®</text>
  </view>

  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="overview-section">
    <view class="overview-title">ğŸ“Š ç»Ÿè®¡æ¦‚è§ˆ</view>
    <view class="overview-cards">
      <view class="overview-card">
        <view class="card-icon">ğŸ“</view>
        <view class="card-content">
          <text class="card-value">{{totalCheckins}}</text>
          <text class="card-label">æ€»æ‰“å¡æ¬¡æ•°</text>
        </view>
      </view>
      
      <view class="overview-card">
        <view class="card-icon">ğŸ“·</view>
        <view class="card-content">
          <text class="card-value">{{totalPhotos}}</text>
          <text class="card-label">æ€»ç…§ç‰‡æ•°</text>
        </view>
      </view>
      
      <view class="overview-card">
        <view class="card-icon">ğŸ—ºï¸</view>
        <view class="card-content">
          <text class="card-value">{{totalAlbums}}</text>
          <text class="card-label">æ€»ç›¸å†Œæ•°</text>
        </view>
      </view>
      
      <view class="overview-card">
        <view class="card-icon">ğŸ‘¥</view>
        <view class="card-content">
          <text class="card-value">{{totalGroups}}</text>
          <text class="card-label">æ€»ç¾¤ç»„æ•°</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ—¶é—´ç­›é€‰ -->
  <view class="filter-section">
    <view class="filter-title">æ—¶é—´èŒƒå›´</view>
    <view class="time-filters">
      <view class="filter-btn {{timeRange === 'week' ? 'active' : ''}}" bindtap="setTimeRange" data-range="week">
        æœ¬å‘¨
      </view>
      <view class="filter-btn {{timeRange === 'month' ? 'active' : ''}}" bindtap="setTimeRange" data-range="month">
        æœ¬æœˆ
      </view>
      <view class="filter-btn {{timeRange === 'year' ? 'active' : ''}}" bindtap="setTimeRange" data-range="year">
        æœ¬å¹´
      </view>
      <view class="filter-btn {{timeRange === 'all' ? 'active' : ''}}" bindtap="setTimeRange" data-range="all">
        å…¨éƒ¨
      </view>
    </view>
  </view>

  <!-- æ‰“å¡ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="section-title">ğŸ“ æ‰“å¡ç»Ÿè®¡</view>
    
    <view class="stats-content">
      <view class="chart-container">
        <view class="chart-title">æ‰“å¡è¶‹åŠ¿</view>
        <view class="trend-chart">
          <view class="chart-bar" wx:for="{{checkinTrend}}" wx:key="date" style="height: {{item.height}}%">
            <view class="bar-tooltip">{{item.count}}æ¬¡</view>
          </view>
        </view>
        <view class="chart-labels">
          <text wx:for="{{checkinTrend}}" wx:key="date">{{item.label}}</text>
        </view>
      </view>
      
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-label">æœ€å¸¸æ‰“å¡æ—¶é—´</text>
          <text class="stat-value">{{mostCheckinTime}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label">æœ€å¸¸æ‰“å¡ç±»å‹</text>
          <text class="stat-value">{{mostCheckinType}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label">å¹³å‡æ‰“å¡é—´éš”</text>
          <text class="stat-value">{{avgCheckinInterval}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label">æœ€é•¿æ‰“å¡é—´éš”</text>
          <text class="stat-value">{{maxCheckinInterval}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç…§ç‰‡ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="section-title">ğŸ“· ç…§ç‰‡ç»Ÿè®¡</view>
    
    <view class="stats-content">
      <view class="photo-stats">
        <view class="stat-row">
          <text class="stat-label">ç…§ç‰‡æ€»æ•°</text>
          <text class="stat-value">{{photoStats.total}}</text>
        </view>
        <view class="stat-row">
          <text class="stat-label">æœ¬æœˆæ–°å¢</text>
          <text class="stat-value">{{photoStats.thisMonth}}</text>
        </view>
        <view class="stat-row">
          <text class="stat-label">æœ¬å‘¨æ–°å¢</text>
          <text class="stat-value">{{photoStats.thisWeek}}</text>
        </view>
        <view class="stat-row">
          <text class="stat-label">å¹³å‡æ¯å¤©</text>
          <text class="stat-value">{{photoStats.avgPerDay}}</text>
        </view>
      </view>
      
      <view class="album-stats">
        <view class="album-chart">
          <view class="chart-title">ç›¸å†Œåˆ†å¸ƒ</view>
          <view class="pie-chart">
            <view class="pie-segment" wx:for="{{albumDistribution}}" wx:key="name" 
                  style="transform: rotate({{item.rotation}}deg); background: {{item.color}};">
              <view class="segment-label">{{item.name}}</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åœ°ç‚¹ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="section-title">ğŸ—ºï¸ åœ°ç‚¹ç»Ÿè®¡</view>
    
    <view class="stats-content">
      <view class="location-stats">
        <view class="top-locations">
          <view class="location-item" wx:for="{{topLocations}}" wx:key="name">
            <view class="location-rank">{{index + 1}}</view>
            <view class="location-info">
              <text class="location-name">{{item.name}}</text>
              <text class="location-count">{{item.count}}æ¬¡æ‰“å¡</text>
            </view>
            <view class="location-percentage">{{item.percentage}}%</view>
          </view>
        </view>
        
        <view class="location-map">
          <view class="map-title">æ‰“å¡çƒ­åŠ›å›¾</view>
          <view class="heatmap-container">
            <view class="heatmap-point" wx:for="{{heatmapPoints}}" wx:key="id"
                  style="left: {{item.x}}%; top: {{item.y}}%; opacity: {{item.intensity}};">
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="section-title">ğŸ·ï¸ æ ‡ç­¾ç»Ÿè®¡</view>
    
    <view class="stats-content">
      <view class="tag-cloud">
        <view class="tag-item" wx:for="{{tagStats}}" wx:key="name" 
              style="font-size: {{item.size}}rpx; opacity: {{item.opacity}};">
          {{item.name}} ({{item.count}})
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†äº«ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="section-title">ğŸ“¤ åˆ†äº«ç»Ÿè®¡</view>
    
    <view class="stats-content">
      <view class="share-stats">
        <view class="share-item">
          <text class="share-label">åˆ†äº«åˆ°å¾®ä¿¡</text>
          <text class="share-value">{{shareStats.wechat}}æ¬¡</text>
        </view>
        <view class="share-item">
          <text class="share-label">åˆ†äº«åˆ°æœ‹å‹åœˆ</text>
          <text class="share-value">{{shareStats.moments}}æ¬¡</text>
        </view>
        <view class="share-item">
          <text class="share-label">ç¾¤ç»„åˆ†äº«</text>
          <text class="share-value">{{shareStats.group}}æ¬¡</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¯¼å‡ºåŠŸèƒ½ -->
  <view class="export-section">
    <view class="section-title">ğŸ“‹ æ•°æ®å¯¼å‡º</view>
    <view class="export-buttons">
      <button class="export-btn" bindtap="exportToImage">
        <text class="btn-icon">ğŸ–¼ï¸</text>
        <text class="btn-text">å¯¼å‡ºä¸ºå›¾ç‰‡</text>
      </button>
      <button class="export-btn" bindtap="exportToPDF">
        <text class="btn-icon">ğŸ“„</text>
        <text class="btn-text">å¯¼å‡ºä¸ºPDF</text>
      </button>
      <button class="export-btn" bindtap="shareStats">
        <text class="btn-icon">ğŸ“¤</text>
        <text class="btn-text">åˆ†äº«ç»Ÿè®¡</text>
      </button>
    </view>
  </view>
</view>
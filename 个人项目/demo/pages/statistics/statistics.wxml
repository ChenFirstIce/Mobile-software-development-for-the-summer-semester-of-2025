<!--pages/statistics/statistics.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">我的旅游统计</text>
    <text class="page-subtitle">记录每一次旅行的美好</text>
    <view class="activity-level">
      <text class="level-text">{{activityLevel}}</text>
      <text class="score-text">活跃度 {{activityScore}}分</text>
    </view>
  </view>

  <!-- 统计概览 -->
  <view class="overview-section">
    <view class="overview-title">
      <image class="title-icon" src="/images/graph.png" mode="aspectFit"></image>
      数据概览
    </view>
    <view class="overview-cards">
      <view class="overview-card primary">
        <image class="card-icon" src="/images/pin.png" mode="aspectFit"></image>
        <view class="card-content">
          <text class="card-value">{{totalCheckins}}</text>
          <text class="card-label">打卡次数</text>
        </view>
      </view>
      
      <view class="overview-card success">
        <image class="card-icon" src="/images/cinema.png" mode="aspectFit"></image>
        <view class="card-content">
          <text class="card-value">{{totalPhotos}}</text>
          <text class="card-label">照片数量</text>
        </view>
      </view>
      
      <view class="overview-card warning">
        <image class="card-icon" src="/images/route.png" mode="aspectFit"></image>
        <view class="card-content">
          <text class="card-value">{{totalDistance}}</text>
          <text class="card-label">行程公里</text>
        </view>
      </view>
      
      <view class="overview-card info">
        <image class="card-icon" src="/images/light-bulb.png" mode="aspectFit"></image>
        <view class="card-content">
          <text class="card-value">{{totalDays}}</text>
          <text class="card-label">活跃天数</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 时间筛选 -->
  <view class="filter-section">
    <view class="filter-title">时间范围</view>
    <view class="time-filters">
      <view class="filter-btn {{timeRange === 'week' ? 'active' : ''}}" bindtap="setTimeRange" data-range="week">
        本周
      </view>
      <view class="filter-btn {{timeRange === 'month' ? 'active' : ''}}" bindtap="setTimeRange" data-range="month">
        本月
      </view>
      <view class="filter-btn {{timeRange === 'year' ? 'active' : ''}}" bindtap="setTimeRange" data-range="year">
        本年
      </view>
      <view class="filter-btn {{timeRange === 'all' ? 'active' : ''}}" bindtap="setTimeRange" data-range="all">
        全部
      </view>
    </view>
  </view>

  <!-- 打卡统计 -->
  <view class="stats-section">
    <view class="section-title">
      <image class="section-icon" src="/images/pin.png" mode="aspectFit"></image>
      打卡统计
    </view>
    
    <view class="stats-content">
      <!-- 连续打卡 -->
      <view class="streak-section">
        <view class="streak-item">
          <view class="streak-icon">🔥</view>
          <view class="streak-info">
            <text class="streak-label">当前连续</text>
            <text class="streak-value">{{checkinStreak}}天</text>
          </view>
        </view>
        <view class="streak-item">
          <view class="streak-icon">🏆</view>
          <view class="streak-info">
            <text class="streak-label">最长连续</text>
            <text class="streak-value">{{longestStreak}}天</text>
          </view>
        </view>
      </view>
      
      <!-- 打卡趋势图 -->
      <view class="chart-container">
        <view class="chart-title">打卡趋势</view>
        <view class="trend-chart">
          <view class="chart-bar" wx:for="{{checkinTrend}}" wx:key="date" style="height: {{item.height}}%">
            <view class="bar-tooltip">{{item.count}}次</view>
          </view>
        </view>
        <view class="chart-labels">
          <text wx:for="{{checkinTrend}}" wx:key="date">{{item.label}}</text>
        </view>
      </view>
      
      <!-- 打卡详情 -->
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-label">最常打卡时间</text>
          <text class="stat-value">{{mostCheckinTime}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label">平均打卡间隔</text>
          <text class="stat-value">{{avgCheckinInterval}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label">最长打卡间隔</text>
          <text class="stat-value">{{maxCheckinInterval}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 照片统计 -->
  <view class="stats-section">
    <view class="section-title">
      <image class="section-icon" src="/images/cinema.png" mode="aspectFit"></image>
      照片统计
    </view>
    
    <view class="stats-content">
      <view class="photo-stats">
        <view class="stat-row">
          <text class="stat-label">照片总数</text>
          <text class="stat-value">{{photoStats.total}}</text>
        </view>
        <view class="stat-row">
          <text class="stat-label">本月新增</text>
          <text class="stat-value">{{photoStats.thisMonth}}</text>
        </view>
        <view class="stat-row">
          <text class="stat-label">本周新增</text>
          <text class="stat-value">{{photoStats.thisWeek}}</text>
        </view>
        <view class="stat-row">
          <text class="stat-label">平均每天</text>
          <text class="stat-value">{{photoStats.avgPerDay}}</text>
        </view>
      </view>
      
    </view>
  </view>

  <!-- 地点统计 -->
  <view class="stats-section">
    <view class="section-title">
      <image class="section-icon" src="/images/map-3.png" mode="aspectFit"></image>
      地点统计
    </view>
    
    <view class="stats-content">
      <view class="location-stats">
        <view class="top-locations">
          <view class="location-item" wx:for="{{topLocations}}" wx:key="name">
            <view class="location-rank">{{index + 1}}</view>
            <view class="location-info">
              <text class="location-name">{{item.name}}</text>
              <text class="location-count">{{item.count}}次打卡</text>
            </view>
            <view class="location-percentage">{{item.percentage}}%</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 群组统计 -->
  <view class="stats-section">
    <view class="section-title">
      <image class="section-icon" src="/images/group-1.png" mode="aspectFit"></image>
      群组统计
    </view>
    
    <view class="stats-content">
      <view class="group-stats">
        <view class="group-stat-item">
          <image class="stat-icon" src="/images/graph.png" mode="aspectFit"></image>
          <view class="stat-info">
            <text class="stat-label">总群组数</text>
            <text class="stat-value">{{groupStats.total}}</text>
          </view>
        </view>
        <view class="group-stat-item">
          <view class="stat-icon">➕</view>
          <view class="stat-info">
            <text class="stat-label">创建群组</text>
            <text class="stat-value">{{groupStats.created}}</text>
          </view>
        </view>
        <view class="group-stat-item">
          <image class="stat-icon" src="/images/networking.png" mode="aspectFit"></image>
          <view class="stat-info">
            <text class="stat-label">加入群组</text>
            <text class="stat-value">{{groupStats.joined}}</text>
          </view>
        </view>
        <view class="group-stat-item">
          <view class="stat-icon">🔥</view>
          <view class="stat-info">
            <text class="stat-label">活跃群组</text>
            <text class="stat-value">{{groupStats.active}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 活跃度统计 -->
  <view class="stats-section">
    <view class="section-title">
      <image class="section-icon" src="/images/newspaper.png" mode="aspectFit"></image>
      活跃度分析
    </view>
    
    <view class="stats-content">
      <!-- 周活跃度 -->
      <view class="activity-chart">
        <view class="chart-title">本周活跃度</view>
        <view class="weekly-chart">
          <view class="day-item" wx:for="{{weeklyActivity}}" wx:key="date">
            <view class="day-bar" style="height: {{item.total * 10}}rpx;"></view>
            <text class="day-label">{{item.date}}</text>
            <text class="day-count">{{item.total}}</text>
          </view>
        </view>
      </view>
      
      <!-- 活跃度等级 -->
      <view class="activity-level-card">
        <view class="level-icon">⭐</view>
        <view class="level-info">
          <text class="level-title">{{activityLevel}}</text>
          <text class="level-desc">活跃度 {{activityScore}}分</text>
        </view>
        <view class="level-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{activityScore / 10}}%;"></view>
          </view>
          <text class="progress-text">{{activityScore}}/1000</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 成就系统 -->
  <view class="stats-section">
    <view class="section-title">🏆 成就徽章</view>
    
    <view class="stats-content">
      <view class="achievements-grid">
        <view class="achievement-item" wx:for="{{achievements}}" wx:key="name">
          <view class="achievement-icon">
            <text>{{item.icon}}</text>
          </view>
          <view class="achievement-info">
            <text class="achievement-name">{{item.name}}</text>
            <text class="achievement-desc">{{item.desc}}</text>
          </view>
          <view class="achievement-status unlocked">已获得</view>
        </view>
        
        <view wx:if="{{achievements.length === 0}}" class="no-achievements">
          <text class="no-achievements-text">暂无成就，继续努力吧！</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 分享按钮 -->
  <view class="share-section">
    <button class="share-btn" open-type="share">
      <text class="share-text">分享统计报告</text>
    </button>
  </view>

</view>